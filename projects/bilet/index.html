<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üìù –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzip/3.1.6/pizzip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.42.3/docxtemplater.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .tabs {
            display: flex;
            background: #ecf0f1;
            border-bottom: 2px solid #bdc3c7;
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1em;
            font-weight: 600;
            color: #7f8c8d;
            transition: all 0.3s;
            position: relative;
        }

        .tab:hover {
            background: #d5dbdb;
        }

        .tab.active {
            color: #2c3e50;
            background: white;
        }

        .tab.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            right: 0;
            height: 2px;
            background: #3498db;
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 25px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2c3e50;
        }

        input[type="text"],
        input[type="number"],
        textarea,
        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ecf0f1;
            border-radius: 8px;
            font-size: 1em;
            transition: border 0.3s;
        }

        input:focus,
        textarea:focus,
        select:focus {
            outline: none;
            border-color: #3498db;
        }

        textarea {
            resize: vertical;
            min-height: 150px;
            font-family: 'Courier New', monospace;
        }

        .file-input {
            border: 2px dashed #bdc3c7;
            padding: 30px;
            text-align: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .file-input:hover {
            border-color: #3498db;
            background: #f8f9fa;
        }

        .file-input input[type="file"] {
            display: none;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.3);
        }

        .btn-success {
            background: linear-gradient(135deg, #27ae60, #229954);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
        }

        .btn-secondary:hover {
            background: #7f8c8d;
        }

        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .results.active {
            display: block;
        }

        .ticket {
            background: white;
            padding: 20px;
            margin-bottom: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .ticket-header {
            font-size: 1.2em;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .question {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 5px;
        }

        .question-number {
            font-weight: bold;
            color: #3498db;
            margin-right: 5px;
        }

        .loader {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loader.active {
            display: block;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .info-box {
            background: #e8f4f8;
            border-left: 4px solid #3498db;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .grid-2 {
                grid-template-columns: 1fr;
            }

            .tabs {
                flex-wrap: wrap;
            }

            .tab {
                flex: 1 1 50%;
            }
        }

        .file-name {
            margin-top: 10px;
            color: #27ae60;
            font-weight: 600;
        }

        .error {
            background: #fadbd8;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
            color: #c0392b;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 700px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #ecf0f1;
        }

        .modal-header h2 {
            margin: 0;
            color: #2c3e50;
        }

        .close {
            font-size: 35px;
            font-weight: bold;
            color: #95a5a6;
            cursor: pointer;
            line-height: 1;
        }

        .close:hover {
            color: #e74c3c;
        }

        .api-option {
            background: #f8f9fa;
            padding: 20px;
            margin: 15px 0;
            border-radius: 10px;
            border-left: 4px solid #3498db;
        }

        .api-option h3 {
            margin-top: 0;
            color: #2c3e50;
        }

        .api-option a {
            color: #3498db;
            text-decoration: none;
            font-weight: 600;
        }

        .api-option a:hover {
            text-decoration: underline;
        }

        .step {
            margin: 10px 0;
            padding-left: 25px;
            position: relative;
        }

        .step::before {
            content: '‚Üí';
            position: absolute;
            left: 0;
            color: #3498db;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìù –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã—Ö –±–∏–ª–µ—Ç–æ–≤</h1>
            <p>–°–æ–∑–¥–∞–≤–∞–π—Ç–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã–µ –±–∏–ª–µ—Ç—ã —Å –ø–æ–º–æ—â—å—é –ò–ò</p>
        </div>

        <!-- API Settings -->
        <div style="background: #2c3e50; padding: 15px 30px; color: white;">
            <div style="display: flex; gap: 20px; align-items: center; flex-wrap: wrap;">
                <div style="flex: 1; min-width: 300px;">
                    <label style="color: white; font-size: 14px; margin-bottom: 5px; display: block;">üîë API –ö–ª—é—á (–¥–ª—è —Ä–µ–∂–∏–º–æ–≤ —Å –ò–ò)</label>
                    <input type="password" id="apiKey" placeholder="–í—Å—Ç–∞–≤—å—Ç–µ –≤–∞—à API –∫–ª—é—á –∑–¥–µ—Å—å" 
                           style="width: 100%; padding: 8px; border: 2px solid #34495e; border-radius: 5px;">
                </div>
                <div style="min-width: 200px;">
                    <label style="color: white; font-size: 14px; margin-bottom: 5px; display: block;">–ü—Ä–æ–≤–∞–π–¥–µ—Ä –ò–ò</label>
                    <select id="aiProvider" style="width: 100%; padding: 8px; border: 2px solid #34495e; border-radius: 5px;">
                        <option value="anthropic">Claude (Anthropic)</option>
                        <option value="gemini">Gemini (Google)</option>
                    </select>
                </div>
                <button onclick="saveApiKey()" style="background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; font-weight: 600; margin-top: 20px;">
                    üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                </button>
            </div>
            <div style="margin-top: 10px; font-size: 12px; opacity: 0.8;">
                <span id="apiStatus">‚ùå API –∫–ª—é—á –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω</span> | 
                <a href="#" onclick="showApiHelp(); return false;" style="color: #3498db;">–ì–¥–µ –≤–∑—è—Ç—å API –∫–ª—é—á?</a>
            </div>
        </div>

        <div class="tabs">
            <button class="tab active" onclick="switchTab(0)">üìã –ì–æ—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã</button>
            <button class="tab" onclick="switchTab(1)">üéØ –¢–µ–º—ã + –ò–ò</button>
            <button class="tab" onclick="switchTab(2)">ü§ñ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è</button>
            <button class="tab" onclick="switchTab(3)">üì¶ –ü–æ –±–ª–æ–∫–∞–º</button>
        </div>

        <!-- –†–µ–∂–∏–º 1: –ì–æ—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã -->
        <div class="tab-content active" id="tab-0">
            <div class="info-box">
                üí° <strong>–†–µ–∂–∏–º 1:</strong> –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –≥–æ—Ç–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (–æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å –Ω–∞ —Å—Ç—Ä–æ–∫—É)
            </div>

            <div class="form-group">
                <label>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ (.txt)</label>
                <div class="file-input" onclick="document.getElementById('file1').click()">
                    <input type="file" id="file1" accept=".txt" onchange="loadQuestions(this)">
                    <div>üìÅ –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</div>
                    <div class="file-name" id="fileName1"></div>
                </div>
            </div>

            <div class="form-group">
                <label>–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ –≤–æ–ø—Ä–æ—Å—ã –≤—Ä—É—á–Ω—É—é (–æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å –Ω–∞ —Å—Ç—Ä–æ–∫—É)</label>
                <textarea id="questions1" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:
–ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ—Ö–∞–Ω–∏–∫–∞?
–ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –∑–∞–∫–æ–Ω—ã –ù—å—é—Ç–æ–Ω–∞.
–û–±—ä—è—Å–Ω–∏—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –¥–≤–∏–≥–∞—Ç–µ–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–≥–æ —Å–≥–æ—Ä–∞–Ω–∏—è."></textarea>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤</label>
                    <input type="number" id="ticketCount1" value="20" min="1" max="100">
                </div>
                <div class="form-group">
                    <label>–í–æ–ø—Ä–æ—Å–æ–≤ –≤ –±–∏–ª–µ—Ç–µ</label>
                    <input type="number" id="questionsPerTicket1" value="3" min="1" max="10">
                </div>
            </div>

            <button class="btn btn-primary" onclick="generateTickets(1)">üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –±–∏–ª–µ—Ç—ã</button>
        </div>

        <!-- –†–µ–∂–∏–º 2: –¢–µ–º—ã + –ò–ò -->
        <div class="tab-content" id="tab-1">
            <div class="info-box">
                üí° <strong>–†–µ–∂–∏–º 2:</strong> –ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ç–µ–º—ã, –∏ –ò–ò —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–æ –∫–∞–∂–¥–æ–π —Ç–µ–º–µ
            </div>

            <div class="form-group">
                <label>–ü—Ä–µ–¥–º–µ—Ç/–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</label>
                <input type="text" id="subject2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞">
            </div>

            <div class="form-group">
                <label>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —Å —Ç–µ–º–∞–º–∏ (.txt)</label>
                <div class="file-input" onclick="document.getElementById('file2').click()">
                    <input type="file" id="file2" accept=".txt" onchange="loadTopics(this)">
                    <div>üìÅ –ù–∞–∂–º–∏—Ç–µ –¥–ª—è –≤—ã–±–æ—Ä–∞ —Ñ–∞–π–ª–∞</div>
                    <div class="file-name" id="fileName2"></div>
                </div>
            </div>

            <div class="form-group">
                <label>–ò–ª–∏ –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–º—ã –≤—Ä—É—á–Ω—É—é (–æ–¥–Ω–∞ —Ç–µ–º–∞ –Ω–∞ —Å—Ç—Ä–æ–∫—É)</label>
                <textarea id="topics2" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:
–°—Ç–∞—Ç–∏–∫–∞ —Ç–≤–µ—Ä–¥–æ–≥–æ —Ç–µ–ª–∞
–ö–∏–Ω–µ–º–∞—Ç–∏–∫–∞ —Ç–æ—á–∫–∏
–î–∏–Ω–∞–º–∏–∫–∞ –º–∞—Ç–µ—Ä–∏–∞–ª—å–Ω–æ–π —Ç–æ—á–∫–∏
–°–æ–ø—Ä–æ—Ç–∏–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤"></textarea>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤</label>
                    <input type="number" id="ticketCount2" value="20" min="1" max="100">
                </div>
                <div class="form-group">
                    <label>–í–æ–ø—Ä–æ—Å–æ–≤ –≤ –±–∏–ª–µ—Ç–µ</label>
                    <input type="number" id="questionsPerTicket2" value="3" min="1" max="10">
                </div>
            </div>

            <button class="btn btn-primary" onclick="generateTickets(2)">ü§ñ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å —Å –ò–ò</button>
        </div>

        <!-- –†–µ–∂–∏–º 3: –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è -->
        <div class="tab-content" id="tab-2">
            <div class="info-box">
                üí° <strong>–†–µ–∂–∏–º 3:</strong> –£–∫–∞–∂–∏—Ç–µ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–¥–º–µ—Ç –∏ —Ç–µ–º—ã - –ò–ò —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã
            </div>

            <div class="form-group">
                <label>–ü—Ä–µ–¥–º–µ—Ç/–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞</label>
                <input type="text" id="subject3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ú–∞—Ç–µ—Ä–∏–∞–ª–æ–≤–µ–¥–µ–Ω–∏–µ">
            </div>

            <div class="form-group">
                <label>–ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ç–µ–º—ã (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label>
                <textarea id="topics3" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä:
–ö—Ä–∏—Å—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –º–µ—Ç–∞–ª–ª–æ–≤
–¢–µ—Ä–º–æ–æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å—Ç–∞–ª–µ–π
–ö–æ—Ä—Ä–æ–∑–∏—è –∏ –∑–∞—â–∏—Ç–∞ –º–µ—Ç–∞–ª–ª–æ–≤
–ö–æ–º–ø–æ–∑–∏—Ü–∏–æ–Ω–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

–ò–ª–∏ –æ—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–º –¥–ª—è –ø–æ–ª–Ω–æ–π –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏"></textarea>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤</label>
                    <input type="number" id="ticketCount3" value="20" min="1" max="100">
                </div>
                <div class="form-group">
                    <label>–í–æ–ø—Ä–æ—Å–æ–≤ –≤ –±–∏–ª–µ—Ç–µ</label>
                    <input type="number" id="questionsPerTicket3" value="3" min="1" max="10">
                </div>
            </div>

            <div class="form-group">
                <label>–£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏</label>
                <select id="difficulty3">
                    <option value="–±–∞–∑–æ–≤—ã–π">–ë–∞–∑–æ–≤—ã–π</option>
                    <option value="—Å—Ä–µ–¥–Ω–∏–π" selected>–°—Ä–µ–¥–Ω–∏–π</option>
                    <option value="–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π">–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π</option>
                </select>
            </div>

            <button class="btn btn-primary" onclick="generateTickets(3)">ü§ñ –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è</button>
        </div>

        <!-- –†–µ–∂–∏–º 4: –ü–æ –±–ª–æ–∫–∞–º -->
        <div class="tab-content" id="tab-3">
            <div class="info-box">
                üí° <strong>–†–µ–∂–∏–º 4:</strong> –í–æ–ø—Ä–æ—Å—ã —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–Ω—ã –ø–æ –±–ª–æ–∫–∞–º (–º–æ–¥—É–ª—è–º), –∏–∑ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –±–µ—Ä–µ—Ç—Å—è —É–∫–∞–∑–∞–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤
            </div>

            <div class="form-group">
                <label>–ë–ª–æ–∫–∏ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏ (—Ñ–æ—Ä–º–∞—Ç: [–ë–õ–û–ö] –≤–æ–ø—Ä–æ—Å1, –≤–æ–ø—Ä–æ—Å2, ...)</label>
                <textarea id="blocks4" placeholder="[–ë–ª–æ–∫ 1: –û—Å–Ω–æ–≤—ã]
–ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ—Ö–∞–Ω–∏–∫–∞?
–ö–∞–∫–∏–µ —Ä–∞–∑–¥–µ–ª—ã –≤–∫–ª—é—á–∞–µ—Ç –º–µ—Ö–∞–Ω–∏–∫–∞?
–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ –ø–æ–Ω—è—Ç–∏–µ —Å–∏–ª—ã.

[–ë–ª–æ–∫ 2: –ó–∞–∫–æ–Ω—ã]
–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –ø–µ—Ä–≤—ã–π –∑–∞–∫–æ–Ω –ù—å—é—Ç–æ–Ω–∞.
–°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤—Ç–æ—Ä–æ–π –∑–∞–∫–æ–Ω –ù—å—é—Ç–æ–Ω–∞.
–ß—Ç–æ —Ç–∞–∫–æ–µ –º–æ–º–µ–Ω—Ç —Å–∏–ª—ã?"></textarea>
            </div>

            <div class="grid-2">
                <div class="form-group">
                    <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±–∏–ª–µ—Ç–æ–≤</label>
                    <input type="number" id="ticketCount4" value="20" min="1" max="100">
                </div>
                <div class="form-group">
                    <label>–í–æ–ø—Ä–æ—Å–æ–≤ –∏–∑ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞</label>
                    <input type="number" id="questionsPerBlock4" value="1" min="1" max="5">
                </div>
            </div>

            <button class="btn btn-primary" onclick="generateTickets(4)">üé≤ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–æ –±–ª–æ–∫–∞–º</button>
        </div>

        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
        <div class="results" id="results">
            <h2 style="margin-bottom: 20px;">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –±–∏–ª–µ—Ç—ã</h2>
            
            <div style="margin-bottom: 20px;">
                <button class="btn btn-success" onclick="exportToWord()">üìÑ –≠–∫—Å–ø–æ—Ä—Ç –≤ Word (–ø—Ä–æ—Å—Ç–æ–π)</button>
                <button class="btn btn-secondary" onclick="downloadTemplate()">üì• –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω Word</button>
                <button class="btn btn-success" onclick="exportWithTemplate()">üìã –≠–∫—Å–ø–æ—Ä—Ç –ø–æ —à–∞–±–ª–æ–Ω—É</button>
                <button class="btn btn-secondary" onclick="showTemplateHelp()">‚ùì –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —à–∞–±–ª–æ–Ω–æ–º</button>
            </div>

            <div class="info-box" style="background: #fff3cd; border-left-color: #ffc107;">
                <strong>üí° –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —à–∞–±–ª–æ–Ω:</strong><br>
                1. –ù–∞–∂–º–∏—Ç–µ <strong>"üì• –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω Word"</strong> - –ø–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω<br>
                2. –û—Ç–∫—Ä–æ–π—Ç–µ —à–∞–±–ª–æ–Ω –≤ Word –∏ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ (–Ω–∞–∑–≤–∞–Ω–∏–µ, –ª–æ–≥–æ—Ç–∏–ø, —à–∞–ø–∫—É)<br>
                3. <strong>–í–∞–∂–Ω–æ!</strong> –û—Å—Ç–∞–≤—å—Ç–µ –º–∞—Ä–∫–µ—Ä—ã: <code>XXX</code> (–¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤) –∏ <code>{ticket_number}</code> (–¥–ª—è –Ω–æ–º–µ—Ä–∞)<br>
                4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω<br>
                5. –ù–∞–∂–º–∏—Ç–µ <strong>"üìã –≠–∫—Å–ø–æ—Ä—Ç –ø–æ —à–∞–±–ª–æ–Ω—É"</strong> –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —à–∞–±–ª–æ–Ω<br>
                6. –ü–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ –≤—Å–µ–º–∏ –±–∏–ª–µ—Ç–∞–º–∏!
            </div>

            <div id="ticketsDisplay"></div>
        </div>

        <!-- Loader -->
        <div class="loader" id="loader">
            <div class="spinner"></div>
            <p>–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –≤–æ–ø—Ä–æ—Å–æ–≤ —Å –ø–æ–º–æ—â—å—é –ò–ò...</p>
        </div>
    </div>

    <!-- Modal –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π API -->
    <div id="apiModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üîë –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á?</h2>
                <span class="close" onclick="closeApiHelp()">&times;</span>
            </div>

            <div class="api-option">
                <h3>1Ô∏è‚É£ Claude API (Anthropic) - –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è</h3>
                <div class="step">–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></div>
                <div class="step">–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å –∏–ª–∏ –≤–æ–π–¥–∏—Ç–µ –≤ –∞–∫–∫–∞—É–Ω—Ç</div>
                <div class="step">–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ —Ä–∞–∑–¥–µ–ª "API Keys"</div>
                <div class="step">–ù–∞–∂–º–∏—Ç–µ "Create Key"</div>
                <div class="step">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á (–Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å sk-ant-...)</div>
                <div class="step">–í—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ "API –ö–ª—é—á" –≤—ã—à–µ</div>
                <p style="margin-top: 15px; color: #7f8c8d; font-size: 14px;">
                    üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: ~$3 –∑–∞ 1 –º–ª–Ω —Ç–æ–∫–µ–Ω–æ–≤ (–æ—á–µ–Ω—å –¥–µ—à–µ–≤–æ)<br>
                    üéÅ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–µ –∫—Ä–µ–¥–∏—Ç—ã: $5 –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
                </p>
            </div>

            <div class="api-option" style="border-left-color: #e74c3c;">
                <h3>2Ô∏è‚É£ Google Gemini API - –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞</h3>
                <div class="step">–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ <a href="https://aistudio.google.com/app/apikey" target="_blank">aistudio.google.com/app/apikey</a></div>
                <div class="step">–í–æ–π–¥–∏—Ç–µ —á–µ—Ä–µ–∑ Google –∞–∫–∫–∞—É–Ω—Ç</div>
                <div class="step">–ù–∞–∂–º–∏—Ç–µ "Create API key"</div>
                <div class="step">–°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–ª—é—á</div>
                <div class="step">–í—Å—Ç–∞–≤—å—Ç–µ –≤ –ø–æ–ª–µ "API –ö–ª—é—á" –∏ –≤—ã–±–µ—Ä–∏—Ç–µ "Gemini" –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–µ</div>
                <p style="margin-top: 15px; color: #7f8c8d; font-size: 14px;">
                    üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å: –ë–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 60 –∑–∞–ø—Ä–æ—Å–æ–≤/–º–∏–Ω—É—Ç—É<br>
                    üéÅ –õ–∏–º–∏—Ç—ã: –û—á–µ–Ω—å —â–µ–¥—Ä—ã–µ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
                </p>
            </div>

            <div style="background: #fff3cd; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #ffc107;">
                <strong>‚ö†Ô∏è –í–∞–∂–Ω–æ:</strong><br>
                ‚Ä¢ –ù–µ –¥–µ–ª–∏—Ç–µ—Å—å API –∫–ª—é—á–æ–º —Å –¥—Ä—É–≥–∏–º–∏<br>
                ‚Ä¢ –ö–ª—é—á —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ<br>
                ‚Ä¢ –î–ª—è —Ä–µ–∂–∏–º–∞ "–ì–æ—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã" –∫–ª—é—á –Ω–µ –Ω—É–∂–µ–Ω<br>
                ‚Ä¢ –†–µ–∂–∏–º—ã —Å –ò–ò —Ç—Ä–µ–±—É—é—Ç –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
            </div>
        </div>
    </div>

    <!-- Modal –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π –ø–æ —à–∞–±–ª–æ–Ω–∞–º -->
    <div id="templateModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>üìÑ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞—Ç—å —Å —à–∞–±–ª–æ–Ω–∞–º–∏ Word</h2>
                <span class="close" onclick="closeTemplateHelp()">&times;</span>
            </div>

            <div style="background: #e8f4f8; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
                <h3 style="margin-top: 0; color: #2c3e50;">üéØ –ß—Ç–æ —Ç–∞–∫–æ–µ —à–∞–±–ª–æ–Ω?</h3>
                <p>–®–∞–±–ª–æ–Ω - —ç—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç Word —Å –≥–æ—Ç–æ–≤—ã–º –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ–º (—à–∞–ø–∫–∞, –ª–æ–≥–æ—Ç–∏–ø, –ø–æ–¥–ø–∏—Å–∏), –∫—É–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –±–∏–ª–µ—Ç—ã –∏ –≤–æ–ø—Ä–æ—Å—ã.</p>
            </div>

            <div class="api-option">
                <h3>üìã –ú–∞—Ä–∫–µ—Ä—ã –≤ —à–∞–±–ª–æ–Ω–µ</h3>
                <p>–í —à–∞–±–ª–æ–Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –º–∞—Ä–∫–µ—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –∑–∞–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –¥–∞–Ω–Ω—ã–µ:</p>
                
                <div style="background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border: 2px solid #ecf0f1;">
                    <strong style="color: #e74c3c;">XXX</strong> –∏–ª–∏ <strong style="color: #e74c3c;">{questions}</strong>
                    <br>
                    <span style="color: #7f8c8d;">‚Üí –ú–µ—Å—Ç–æ –∫—É–¥–∞ –≤—Å—Ç–∞–≤—è—Ç—Å—è –í–°–ï –≤–æ–ø—Ä–æ—Å—ã –±–∏–ª–µ—Ç–∞</span>
                    <br><br>
                    <em>–ü—Ä–∏–º–µ—Ä:</em><br>
                    <code style="background: #f8f9fa; padding: 5px;">XXX</code><br>
                    –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—Å—è –≤:<br>
                    <code style="background: #f8f9fa; padding: 5px;">1. –ß—Ç–æ —Ç–∞–∫–æ–µ –º–µ—Ö–∞–Ω–∏–∫–∞?<br>2. –ü–µ—Ä–µ—á–∏—Å–ª–∏—Ç–µ –∑–∞–∫–æ–Ω—ã –ù—å—é—Ç–æ–Ω–∞.<br>3. –û–±—ä—è—Å–Ω–∏—Ç–µ –ø—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –¥–≤–∏–≥–∞—Ç–µ–ª—è.</code>
                </div>

                <div style="background: white; padding: 15px; margin: 10px 0; border-radius: 5px; border: 2px solid #ecf0f1;">
                    <strong style="color: #e74c3c;">{ticket_number}</strong>
                    <br>
                    <span style="color: #7f8c8d;">‚Üí –ù–æ–º–µ—Ä –±–∏–ª–µ—Ç–∞</span>
                    <br><br>
                    <em>–ü—Ä–∏–º–µ—Ä:</em><br>
                    <code style="background: #f8f9fa; padding: 5px;">–ë–ò–õ–ï–¢ ‚Ññ {ticket_number}</code><br>
                    –ü—Ä–µ–≤—Ä–∞—Ç–∏—Ç—Å—è –≤:<br>
                    <code style="background: #f8f9fa; padding: 5px;">–ë–ò–õ–ï–¢ ‚Ññ 1</code>, <code>–ë–ò–õ–ï–¢ ‚Ññ 2</code> –∏ —Ç.–¥.
                </div>
            </div>

            <div class="api-option" style="border-left-color: #27ae60;">
                <h3>‚úÖ –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
                <div class="step">–ù–∞–∂–º–∏—Ç–µ <strong>"üì• –°–∫–∞—á–∞—Ç—å —à–∞–±–ª–æ–Ω Word"</strong></div>
                <div class="step">–û—Ç–∫—Ä–æ–π—Ç–µ —Å–∫–∞—á–∞–Ω–Ω—ã–π —Ñ–∞–π–ª <code>—à–∞–±–ª–æ–Ω_–±–∏–ª–µ—Ç–∞.docx</code> –≤ Microsoft Word</div>
                <div class="step">–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —à–∞–ø–∫—É (–Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç–∏—Ç—É—Ç–∞, –∫–∞—Ñ–µ–¥—Ä—ã, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã)</div>
                <div class="step">–î–æ–±–∞–≤—å—Ç–µ –ª–æ–≥–æ—Ç–∏–ø, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ</div>
                <div class="step"><strong>–ù–ï –£–î–ê–õ–Ø–ô–¢–ï</strong> –º–∞—Ä–∫–µ—Ä—ã <code>XXX</code> –∏ <code>{ticket_number}</code>!</div>
                <div class="step">–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω</div>
                <div class="step">–í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –Ω–∞–∂–º–∏—Ç–µ <strong>"üìã –≠–∫—Å–ø–æ—Ä—Ç –ø–æ —à–∞–±–ª–æ–Ω—É"</strong></div>
                <div class="step">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à —à–∞–±–ª–æ–Ω</div>
                <div class="step">–ü–æ–ª—É—á–∏—Ç–µ –≥–æ—Ç–æ–≤—ã–π –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ –í–°–ï–ú–ò –±–∏–ª–µ—Ç–∞–º–∏!</div>
            </div>

            <div style="background: #fadbd8; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #e74c3c;">
                <strong>‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞:</strong><br>
                ‚Ä¢ –ú–∞—Ä–∫–µ—Ä <code>XXX</code> –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω–æ–π —Å—Ç—Ä–æ–∫–µ<br>
                ‚Ä¢ –û—Å—Ç–∞–≤—å—Ç–µ –ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏ –¥–æ –∏ –ø–æ—Å–ª–µ <code>XXX</code><br>
                ‚Ä¢ –ù–µ —Å—Ç–∞–≤—å—Ç–µ <code>XXX</code> –≤–Ω—É—Ç—Ä–∏ —Ç–∞–±–ª–∏—Ü—ã<br>
                ‚Ä¢ –ú–∞—Ä–∫–µ—Ä—ã –ø–∏—à—É—Ç—Å—è –ó–ê–ì–õ–ê–í–ù–´–ú–ò –±—É–∫–≤–∞–º–∏<br>
                ‚Ä¢ –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å <code>{questions}</code> –≤–º–µ—Å—Ç–æ <code>XXX</code>
            </div>

            <div style="background: #d5f4e6; padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 4px solid #27ae60;">
                <strong>üí° –ü—Ä–∏–º–µ—Ä –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞:</strong><br><br>
                <code style="background: white; padding: 10px; display: block; white-space: pre-wrap;">–ú–ò–ù–ò–°–¢–ï–†–°–¢–í–û –û–ë–†–ê–ó–û–í–ê–ù–ò–Ø

–≠–ö–ó–ê–ú–ï–ù–ê–¶–ò–û–ù–ù–´–ô –ë–ò–õ–ï–¢ ‚Ññ {ticket_number}

–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞: –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞
–ö—É—Ä—Å: 2  –ì—Ä—É–ø–ø–∞: ______


XXX


–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: _________  –î–∞—Ç–∞: _______</code>
            </div>
        </div>
    </div>

    <script>
        let generatedTickets = [];
        let currentMode = 1;
        let apiKey = localStorage.getItem('ai_api_key') || '';
        let aiProvider = localStorage.getItem('ai_provider') || 'anthropic';

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        window.onload = function() {
            if (apiKey) {
                document.getElementById('apiKey').value = apiKey;
                document.getElementById('apiProvider').value = aiProvider;
                updateApiStatus(true);
            }
        };

        function saveApiKey() {
            apiKey = document.getElementById('apiKey').value.trim();
            aiProvider = document.getElementById('apiProvider').value;
            
            if (apiKey) {
                localStorage.setItem('ai_api_key', apiKey);
                localStorage.setItem('ai_provider', aiProvider);
                updateApiStatus(true);
                alert('‚úÖ API –∫–ª—é—á —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
            } else {
                alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á');
            }
        }

        function updateApiStatus(hasKey) {
            const statusEl = document.getElementById('apiStatus');
            if (hasKey) {
                statusEl.innerHTML = '‚úÖ API –∫–ª—é—á —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
                statusEl.style.color = '#27ae60';
            } else {
                statusEl.innerHTML = '‚ùå API –∫–ª—é—á –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω';
                statusEl.style.color = '#e74c3c';
            }
        }

        function showApiHelp() {
            document.getElementById('apiModal').style.display = 'block';
        }

        function closeApiHelp() {
            document.getElementById('apiModal').style.display = 'none';
        }

        function showTemplateHelp() {
            document.getElementById('templateModal').style.display = 'block';
        }

        function closeTemplateHelp() {
            document.getElementById('templateModal').style.display = 'none';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const apiModal = document.getElementById('apiModal');
            const templateModal = document.getElementById('templateModal');
            if (event.target == apiModal) {
                apiModal.style.display = 'none';
            }
            if (event.target == templateModal) {
                templateModal.style.display = 'none';
            }
        }

        async function downloadTemplate() {
            // –°–æ–∑–¥–∞–µ–º –±–∞–∑–æ–≤—ã–π —à–∞–±–ª–æ–Ω –±–∏–ª–µ—Ç–∞
            const templateContent = `–ú–ò–ù–ò–°–¢–ï–†–°–¢–í–û –í–´–°–®–ï–ì–û –û–ë–†–ê–ó–û–í–ê–ù–ò–Ø, –ù–ê–£–ö–ò –ò –ò–ù–ù–û–í–ê–¶–ò–ô
–†–ï–°–ü–£–ë–õ–ò–ö–ò –£–ó–ë–ï–ö–ò–°–¢–ê–ù

–¢–ê–®–ö–ï–ù–¢–°–ö–ò–ô –ò–ù–°–¢–ò–¢–£–¢ –¢–ï–ö–°–¢–ò–õ–¨–ù–û–ô –ò –õ–ï–ì–ö–û–ô –ü–†–û–ú–´–®–õ–ï–ù–ù–û–°–¢–ò


                                          ¬´–£–¢–í–ï–†–ñ–î–ê–Æ¬ª
                                          –ó–∞–≤. –∫–∞—Ñ–µ–¥—Ä–æ–π __________
                                          ¬´___¬ª _________ 202__ –≥.



–≠–ö–ó–ê–ú–ï–ù–ê–¶–ò–û–ù–ù–´–ô –ë–ò–õ–ï–¢ ‚Ññ {ticket_number}


–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞: ______________________________________________________

–ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: _____________________________________________________

–ö—É—Ä—Å: ________  –ì—Ä—É–ø–ø–∞: ________  –°–µ–º–µ—Å—Ç—Ä: ________



XXX




–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: ____________________ / _____________ /
                      (–ø–æ–¥–ø–∏—Å—å)              (–§.–ò.–û.)

–î–∞—Ç–∞ —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è: ¬´___¬ª _____________ 202__ –≥.




‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

–ò–ù–°–¢–†–£–ö–¶–ò–Ø:
1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —ç—Ç–æ—Ç —à–∞–±–ª–æ–Ω –≤ Word (–Ω–∞–∑–≤–∞–Ω–∏–µ –∏–Ω—Å—Ç–∏—Ç—É—Ç–∞, –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—É –∏ —Ç.–¥.)
2. –ù–ï –£–î–ê–õ–Ø–ô–¢–ï –º–∞—Ä–∫–µ—Ä—ã: XXX –∏ {ticket_number}
3. XXX - –º–µ—Å—Ç–æ –∫—É–¥–∞ –≤—Å—Ç–∞–≤—è—Ç—Å—è –≤—Å–µ –≤–æ–ø—Ä–æ—Å—ã –±–∏–ª–µ—Ç–∞
4. {ticket_number} - –±—É–¥–µ—Ç –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ –Ω–æ–º–µ—Ä –±–∏–ª–µ—Ç–∞ (1, 2, 3...)
5. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –æ—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —à–∞–±–ª–æ–Ω
6. –í –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –≤—ã–±–µ—Ä–∏—Ç–µ "–≠–∫—Å–ø–æ—Ä—Ç –ø–æ —à–∞–±–ª–æ–Ω—É" –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤–∞—à —Ñ–∞–π–ª
`;

            const blob = new Blob([templateContent], { type: 'text/plain;charset=utf-8' });
            saveAs(blob, '—à–∞–±–ª–æ–Ω_–±–∏–ª–µ—Ç–∞.txt');
            
            alert('üì• –®–∞–±–ª–æ–Ω —Å–∫–∞—á–∞–Ω!\n\n1. –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ Word\n2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –∫–∞–∫ –Ω—É–∂–Ω–æ\n3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ .docx\n4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ "–≠–∫—Å–ø–æ—Ä—Ç –ø–æ —à–∞–±–ª–æ–Ω—É"');
        }

        function switchTab(index) {
            // –°–∫—Ä—ã—Ç—å –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            // –ü–æ–∫–∞–∑–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –≤–∫–ª–∞–¥–∫—É
            document.querySelectorAll('.tab')[index].classList.add('active');
            document.getElementById(`tab-${index}`).classList.add('active');
            
            // –°–∫—Ä—ã—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏
            document.getElementById('results').classList.remove('active');
        }

        function loadQuestions(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('questions1').value = e.target.result;
                    document.getElementById('fileName1').textContent = `‚úì –ó–∞–≥—Ä—É–∂–µ–Ω: ${file.name}`;
                };
                reader.readAsText(file);
            }
        }

        function loadTopics(input) {
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('topics2').value = e.target.result;
                    document.getElementById('fileName2').textContent = `‚úì –ó–∞–≥—Ä—É–∂–µ–Ω: ${file.name}`;
                };
                reader.readAsText(file);
            }
        }

        async function generateTickets(mode) {
            currentMode = mode;
            let questions = [];
            
            try {
                if (mode === 1) {
                    // –†–µ–∂–∏–º 1: –ì–æ—Ç–æ–≤—ã–µ –≤–æ–ø—Ä–æ—Å—ã
                    const text = document.getElementById('questions1').value.trim();
                    if (!text) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∏–ª–∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ –≤–æ–ø—Ä–æ—Å—ã!');
                        return;
                    }
                    
                    questions = text.split('\n').filter(q => q.trim());
                    const ticketCount = parseInt(document.getElementById('ticketCount1').value);
                    const questionsPerTicket = parseInt(document.getElementById('questionsPerTicket1').value);
                    
                    if (questions.length < questionsPerTicket) {
                        alert(`–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –≤–æ–ø—Ä–æ—Å–æ–≤! –ù—É–∂–Ω–æ –º–∏–Ω–∏–º—É–º ${questionsPerTicket} –≤–æ–ø—Ä–æ—Å–æ–≤.`);
                        return;
                    }
                    
                    generatedTickets = generateTicketsFromQuestions(questions, ticketCount, questionsPerTicket);
                    
                } else if (mode === 2) {
                    // –†–µ–∂–∏–º 2: –¢–µ–º—ã + –ò–ò
                    const subject = document.getElementById('subject2').value.trim();
                    const topicsText = document.getElementById('topics2').value.trim();
                    
                    if (!subject || !topicsText) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç –∏ —Ç–µ–º—ã!');
                        return;
                    }
                    
                    const topics = topicsText.split('\n').filter(t => t.trim());
                    const ticketCount = parseInt(document.getElementById('ticketCount2').value);
                    const questionsPerTicket = parseInt(document.getElementById('questionsPerTicket2').value);
                    
                    showLoader(true);
                    questions = await generateQuestionsFromTopics(subject, topics, ticketCount * questionsPerTicket);
                    showLoader(false);
                    
                    generatedTickets = generateTicketsFromQuestions(questions, ticketCount, questionsPerTicket);
                    
                } else if (mode === 3) {
                    // –†–µ–∂–∏–º 3: –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è
                    const subject = document.getElementById('subject3').value.trim();
                    
                    if (!subject) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É–∫–∞–∂–∏—Ç–µ –ø—Ä–µ–¥–º–µ—Ç!');
                        return;
                    }
                    
                    const topicsText = document.getElementById('topics3').value.trim();
                    const ticketCount = parseInt(document.getElementById('ticketCount3').value);
                    const questionsPerTicket = parseInt(document.getElementById('questionsPerTicket3').value);
                    const difficulty = document.getElementById('difficulty3').value;
                    
                    showLoader(true);
                    questions = await autoGenerateQuestions(subject, topicsText, ticketCount * questionsPerTicket, difficulty);
                    showLoader(false);
                    
                    generatedTickets = generateTicketsFromQuestions(questions, ticketCount, questionsPerTicket);
                    
                } else if (mode === 4) {
                    // –†–µ–∂–∏–º 4: –ü–æ –±–ª–æ–∫–∞–º
                    const blocksText = document.getElementById('blocks4').value.trim();
                    
                    if (!blocksText) {
                        alert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –±–ª–æ–∫–∏ —Å –≤–æ–ø—Ä–æ—Å–∞–º–∏!');
                        return;
                    }
                    
                    const blocks = parseBlocks(blocksText);
                    const ticketCount = parseInt(document.getElementById('ticketCount4').value);
                    const questionsPerBlock = parseInt(document.getElementById('questionsPerBlock4').value);
                    
                    generatedTickets = generateTicketsFromBlocks(blocks, ticketCount, questionsPerBlock);
                }
                
                displayTickets();
                document.getElementById('results').classList.add('active');
                document.getElementById('results').scrollIntoView({ behavior: 'smooth' });
                
            } catch (error) {
                showLoader(false);
                alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –±–∏–ª–µ—Ç–æ–≤: ' + error.message);
                console.error(error);
            }
        }

        function generateTicketsFromQuestions(questions, ticketCount, questionsPerTicket) {
            const tickets = [];
            const availableQuestions = [...questions];
            
            // –ü–µ—Ä–µ–º–µ—à–∏–≤–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã
            shuffleArray(availableQuestions);
            
            for (let i = 0; i < ticketCount; i++) {
                const ticket = {
                    number: i + 1,
                    questions: []
                };
                
                // –ï—Å–ª–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç, –Ω–∞—á–∏–Ω–∞–µ–º –∑–∞–Ω–æ–≤–æ
                if (availableQuestions.length < questionsPerTicket) {
                    availableQuestions.push(...questions);
                    shuffleArray(availableQuestions);
                }
                
                // –ë–µ—Ä–µ–º –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ–ø—Ä–æ—Å–æ–≤
                for (let j = 0; j < questionsPerTicket; j++) {
                    ticket.questions.push(availableQuestions.shift());
                }
                
                tickets.push(ticket);
            }
            
            return tickets;
        }

        function generateTicketsFromBlocks(blocks, ticketCount, questionsPerBlock) {
            const tickets = [];
            
            for (let i = 0; i < ticketCount; i++) {
                const ticket = {
                    number: i + 1,
                    questions: []
                };
                
                // –ò–∑ –∫–∞–∂–¥–æ–≥–æ –±–ª–æ–∫–∞ –±–µ—Ä–µ–º —Å–ª—É—á–∞–π–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã
                blocks.forEach(block => {
                    const shuffled = [...block.questions];
                    shuffleArray(shuffled);
                    
                    for (let j = 0; j < Math.min(questionsPerBlock, shuffled.length); j++) {
                        ticket.questions.push(shuffled[j]);
                    }
                });
                
                tickets.push(ticket);
            }
            
            return tickets;
        }

        function parseBlocks(text) {
            const blocks = [];
            const lines = text.split('\n');
            let currentBlock = null;
            
            lines.forEach(line => {
                line = line.trim();
                if (!line) return;
                
                if (line.startsWith('[') && line.includes(']')) {
                    // –ù–æ–≤—ã–π –±–ª–æ–∫
                    const blockName = line.substring(1, line.indexOf(']'));
                    currentBlock = { name: blockName, questions: [] };
                    blocks.push(currentBlock);
                } else if (currentBlock) {
                    // –í–æ–ø—Ä–æ—Å –≤ —Ç–µ–∫—É—â–µ–º –±–ª–æ–∫–µ
                    currentBlock.questions.push(line);
                }
            });
            
            return blocks;
        }

        async function generateQuestionsFromTopics(subject, topics, totalQuestions) {
            if (!apiKey) {
                alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ API –∫–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ò–ò!\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É "–ì–¥–µ –≤–∑—è—Ç—å API –∫–ª—é—á?" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.');
                return [];
            }

            const questionsPerTopic = Math.ceil(totalQuestions / topics.length);
            const allQuestions = [];
            
            for (const topic of topics) {
                const prompt = `–¢—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã "${subject}". –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π ${questionsPerTopic} —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –ø–æ —Ç–µ–º–µ "${topic}". 

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –í–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–µ–º—ã
- –†–∞–∑–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
- –§–æ—Ä–º–∞—Ç: –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤, –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É
- –ë–µ–∑ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

–í–æ–ø—Ä–æ—Å—ã:`;

                try {
                    let questions = [];
                    
                    if (aiProvider === 'anthropic') {
                        // Claude API
                        const response = await fetch("https://api.anthropic.com/v1/messages", {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                                "x-api-key": apiKey,
                                "anthropic-version": "2023-06-01"
                            },
                            body: JSON.stringify({
                                model: "claude-sonnet-4-20250514",
                                max_tokens: 1000,
                                messages: [
                                    { role: "user", content: prompt }
                                ],
                            })
                        });

                        if (!response.ok) {
                            throw new Error(`Claude API error: ${response.status} - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞`);
                        }

                        const data = await response.json();
                        questions = data.content[0].text.trim().split('\n').filter(q => q.trim());
                        
                    } else if (aiProvider === 'gemini') {
                        // Gemini API
                        const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${apiKey}`, {
                            method: "POST",
                            headers: {
                                "Content-Type": "application/json",
                            },
                            body: JSON.stringify({
                                contents: [{
                                    parts: [{
                                        text: prompt
                                    }]
                                }],
                                generationConfig: {
                                    temperature: 0.7,
                                    maxOutputTokens: 1000
                                }
                            })
                        });

                        if (!response.ok) {
                            const errorData = await response.text();
                            console.error('Gemini API error:', errorData);
                            throw new Error(`Gemini API error: ${response.status} - ${errorData.substring(0, 100)}`);
                        }

                        const data = await response.json();
                        if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                            throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Gemini API');
                        }
                        const text = data.candidates[0].content.parts[0].text;
                        questions = text.trim().split('\n').filter(q => q.trim());
                    }
                    
                    allQuestions.push(...questions);
                    
                } catch (error) {
                    console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –≤–æ–ø—Ä–æ—Å–æ–≤ –¥–ª—è —Ç–µ–º—ã:', topic, error);
                    alert(`–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${error.message}`);
                    throw error;
                }
            }
            
            return allQuestions;
        }

        async function autoGenerateQuestions(subject, topicsText, totalQuestions, difficulty) {
            if (!apiKey) {
                alert('‚ö†Ô∏è –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ API –∫–ª—é—á –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ò–ò!\n–ù–∞–∂–º–∏—Ç–µ –Ω–∞ —Å—Å—ã–ª–∫—É "–ì–¥–µ –≤–∑—è—Ç—å API –∫–ª—é—á?" –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.');
                return [];
            }

            const prompt = topicsText 
                ? `–¢—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã "${subject}". –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π ${totalQuestions} —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ —Å —É—Ä–æ–≤–Ω–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ "${difficulty}".

–ü—Ä–∏–º–µ—Ä–Ω—ã–µ —Ç–µ–º—ã –¥–ª—è –æ—Ö–≤–∞—Ç–∞:
${topicsText}

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –í–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –æ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å —É–∫–∞–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã
- –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: ${difficulty}
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏
- –§–æ—Ä–º–∞—Ç: –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤, –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É
- –ë–µ–∑ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

–í–æ–ø—Ä–æ—Å—ã:`
                : `–¢—ã –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã "${subject}". –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π ${totalQuestions} —ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ —Å —É—Ä–æ–≤–Ω–µ–º —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ "${difficulty}".

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- –í–æ–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –æ—Ö–≤–∞—Ç—ã–≤–∞—Ç—å –æ—Å–Ω–æ–≤–Ω—ã–µ —Ä–∞–∑–¥–µ–ª—ã –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã
- –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏: ${difficulty}
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏
- –§–æ—Ä–º–∞—Ç: –ø—Ä–æ—Å—Ç–æ —Å–ø–∏—Å–æ–∫ –≤–æ–ø—Ä–æ—Å–æ–≤, –ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É
- –ë–µ–∑ –Ω—É–º–µ—Ä–∞—Ü–∏–∏ –∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞

–í–æ–ø—Ä–æ—Å—ã:`;

            try {
                let questions = [];
                
                if (aiProvider === 'anthropic') {
                    // Claude API
                    const response = await fetch("https://api.anthropic.com/v1/messages", {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                            "x-api-key": apiKey,
                            "anthropic-version": "2023-06-01"
                        },
                        body: JSON.stringify({
                            model: "claude-sonnet-4-20250514",
                            max_tokens: 2000,
                            messages: [
                                { role: "user", content: prompt }
                            ],
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`Claude API error: ${response.status} - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å API –∫–ª—é—á–∞`);
                    }

                    const data = await response.json();
                    questions = data.content[0].text.trim().split('\n').filter(q => q.trim());
                    
                } else if (aiProvider === 'gemini') {
                    // Gemini API
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1/models/gemini-pro:generateContent?key=${apiKey}`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json",
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: prompt
                                }]
                            }],
                            generationConfig: {
                                temperature: 0.7,
                                maxOutputTokens: 1000
                            }
                        })
                    });

                    if (!response.ok) {
                        const errorData = await response.text();
                        console.error('Gemini API error:', errorData);
                        throw new Error(`Gemini API error: ${response.status} - ${errorData.substring(0, 100)}`);
                    }

                    const data = await response.json();
                    if (!data.candidates || !data.candidates[0] || !data.candidates[0].content) {
                        throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç Gemini API');
                    }
                    const text = data.candidates[0].content.parts[0].text;
                    questions = text.trim().split('\n').filter(q => q.trim());
                }
                
                return questions;
                
            } catch (error) {
                alert(`–û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: ${error.message}`);
                throw new Error('–ù–µ —É–¥–∞–ª–æ—Å—å —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã: ' + error.message);
            }
        }

        function displayTickets() {
            const display = document.getElementById('ticketsDisplay');
            display.innerHTML = '';
            
            generatedTickets.forEach(ticket => {
                const ticketDiv = document.createElement('div');
                ticketDiv.className = 'ticket';
                
                let html = `<div class="ticket-header">–ë–∏–ª–µ—Ç ‚Ññ ${ticket.number}</div>`;
                
                ticket.questions.forEach((question, index) => {
                    html += `
                        <div class="question">
                            <span class="question-number">–í–æ–ø—Ä–æ—Å ${index + 1}:</span>
                            ${question}
                        </div>
                    `;
                });
                
                ticketDiv.innerHTML = html;
                display.appendChild(ticketDiv);
            });
        }

        function exportToWord() {
            if (generatedTickets.length === 0) {
                alert('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –±–∏–ª–µ—Ç—ã!');
                return;
            }

            let content = '';
            
            generatedTickets.forEach((ticket, index) => {
                content += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n`;
                content += `              –≠–ö–ó–ê–ú–ï–ù–ê–¶–ò–û–ù–ù–´–ô –ë–ò–õ–ï–¢ ‚Ññ ${ticket.number}\n`;
                content += `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n`;
                content += `–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞: _____________________________________________\n\n`;
                content += `–ö—É—Ä—Å: _____  –ì—Ä—É–ø–ø–∞: _____  –°–µ–º–µ—Å—Ç—Ä: _____\n\n\n`;
                
                ticket.questions.forEach((question, qIndex) => {
                    content += `${qIndex + 1}. ${question}\n\n`;
                });
                
                content += `\n\n`;
                content += `–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: __________________  –î–∞—Ç–∞: __________\n`;
                content += `\n\n\n`;
                
                // –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –±–∏–ª–µ—Ç–∞–º–∏ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ)
                if (index < generatedTickets.length - 1) {
                    content += `\n\n\n\n`;
                }
            });

            // –°–æ–∑–¥–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            saveAs(blob, '–≤—Å–µ_—ç–∫–∑–∞–º–µ–Ω–∞—Ü–∏–æ–Ω–Ω—ã–µ_–±–∏–ª–µ—Ç—ã.txt');
            
            alert('‚úÖ –í—Å–µ –±–∏–ª–µ—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª!\n\nüìù –û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª .txt –≤ Microsoft Word –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:\n\n1. –û—Ç–∫—Ä–æ–π—Ç–µ Word\n2. –§–∞–π–ª ‚Üí –û—Ç–∫—Ä—ã—Ç—å ‚Üí –≤—ã–±–µ—Ä–∏—Ç–µ .txt —Ñ–∞–π–ª\n3. –û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–π—Ç–µ –ø–æ —Å–≤–æ–µ–º—É –≤–∫—É—Å—É\n4. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ .docx');
        }

        async function exportWithTemplate() {
            if (generatedTickets.length === 0) {
                alert('‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ —Å–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –±–∏–ª–µ—Ç—ã!');
                return;
            }

            // –ó–∞–ø—Ä–æ—Å –Ω–∞ –∑–∞–≥—Ä—É–∑–∫—É —à–∞–±–ª–æ–Ω–∞
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.docx,.txt';
            
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                
                try {
                    const reader = new FileReader();
                    
                    if (file.name.endsWith('.txt')) {
                        // –¢–µ–∫—Å—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω
                        reader.onload = function(e) {
                            const template = e.target.result;
                            let fullDocument = '';
                            
                            generatedTickets.forEach((ticket, index) => {
                                const questionsText = ticket.questions
                                    .map((q, i) => `${i + 1}. ${q}`)
                                    .join('\n\n');
                                
                                let ticketText = template
                                    .replace(/{ticket_number}/g, ticket.number)
                                    .replace(/XXX/g, questionsText)
                                    .replace(/{questions}/g, questionsText);
                                
                                fullDocument += ticketText;
                                
                                // –î–æ–±–∞–≤–ª—è–µ–º —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –±–∏–ª–µ—Ç–∞–º–∏ (–∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ)
                                if (index < generatedTickets.length - 1) {
                                    fullDocument += '\n\n\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n\n';
                                }
                            });
                            
                            const blob = new Blob([fullDocument], { type: 'text/plain;charset=utf-8' });
                            saveAs(blob, '–≤—Å–µ_–±–∏–ª–µ—Ç—ã_–ø–æ_—à–∞–±–ª–æ–Ω—É.txt');
                            
                            alert('‚úÖ –í—Å–µ –±–∏–ª–µ—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª!\n\n–û—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª –≤ Word –¥–ª—è –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è.');
                        };
                        
                        reader.readAsText(file);
                        
                    } else if (file.name.endsWith('.docx')) {
                        // Word —à–∞–±–ª–æ–Ω (–ø–æ–∫–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è)
                        alert('üìÑ –î–ª—è .docx —à–∞–±–ª–æ–Ω–æ–≤:\n\n1. –°–∫–∞—á–∞–π—Ç–µ —à–∞–±–ª–æ–Ω –∫–∞–∫ .txt\n2. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –≤ Word\n3. –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∫–∞–∫ .docx\n4. –ü–æ–∫–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–π —ç–∫—Å–ø–æ—Ä—Ç\n\n(–ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ .docx –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)');
                    }
                    
                } catch (error) {
                    alert('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —à–∞–±–ª–æ–Ω–æ–º: ' + error.message);
                    console.error(error);
                }
            };
            
            input.click();
        }

        function showLoader(show) {
            document.getElementById('loader').classList.toggle('active', show);
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }
    </script>
</body>
</html>

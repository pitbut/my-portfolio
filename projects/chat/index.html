<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí¨ –°–≤–æ–±–æ–¥–Ω—ã–π —á–∞—Ç –º–∏–ª–ª–∏–∞—Ä–¥–µ—Ä–æ–≤</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    
    <!-- React -->
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .app-container {
            width: 100%;
            max-width: 1200px;
            height: 90vh;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }

        .header {
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #1a1a2e;
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .online-count {
            background: rgba(26, 26, 46, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
        }

        .login-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 40px;
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(244, 208, 63, 0.1) 100%);
        }

        .login-box {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
            width: 100%;
            max-width: 400px;
            text-align: center;
        }

        .login-box h2 {
            color: #1a1a2e;
            margin-bottom: 10px;
            font-size: 28px;
        }

        .login-box p {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .btn-primary {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .chat-container {
            flex: 1;
            display: flex;
            overflow: hidden;
        }

        .sidebar {
            width: 280px;
            background: #f8f9fa;
            border-right: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 20px;
            background: #1a1a2e;
            color: white;
        }

        .sidebar-header h3 {
            font-size: 16px;
            margin-bottom: 5px;
        }

        .user-info {
            font-size: 14px;
            color: #d4af37;
            font-weight: 600;
        }

        .users-list {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
        }

        .user-item {
            padding: 12px;
            margin-bottom: 8px;
            background: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
        }

        .user-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #1a1a2e;
        }

        .online-indicator {
            width: 10px;
            height: 10px;
            background: #4caf50;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .main-chat {
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 30px;
            background: linear-gradient(to bottom, #ffffff 0%, #f8f9fa 100%);
        }

        .message {
            margin-bottom: 20px;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .message-avatar {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            color: #1a1a2e;
            font-size: 14px;
        }

        .message-author {
            font-weight: 700;
            color: #1a1a2e;
        }

        .message-time {
            font-size: 12px;
            color: #999;
        }

        .message-content {
            margin-left: 45px;
            padding: 12px 16px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
            word-wrap: break-word;
        }

        .message.own .message-content {
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #1a1a2e;
            font-weight: 500;
        }

        .input-container {
            padding: 20px 30px;
            background: white;
            border-top: 1px solid #e0e0e0;
            display: flex;
            gap: 15px;
        }

        .message-input {
            flex: 1;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 25px;
            font-size: 15px;
            transition: all 0.3s;
        }

        .message-input:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .send-button {
            padding: 15px 30px;
            background: linear-gradient(135deg, #d4af37 0%, #f4d03f 100%);
            color: #1a1a2e;
            border: none;
            border-radius: 25px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .send-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.4);
        }

        .send-button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .empty-chat {
            text-align: center;
            color: #999;
            padding: 40px;
        }

        .empty-chat-icon {
            font-size: 48px;
            margin-bottom: 10px;
        }

        .logout-button {
            padding: 8px 16px;
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .logout-button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .loading {
            text-align: center;
            padding: 20px;
            color: #999;
        }

        @media (max-width: 768px) {
            .sidebar {
                display: none;
            }
            
            .app-container {
                height: 95vh;
            }
        }

        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ============================================
        // FIREBASE –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø
        // ============================================
        // –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ —ç—Ç–∏ –¥–∞–Ω–Ω—ã–µ –Ω–∞ —Å–≤–æ–∏ –∏–∑ Firebase Console
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY_HERE",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        const isConfigured = !firebaseConfig.apiKey.includes('YOUR_');

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
        let database = null;
        if (isConfigured) {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                database = firebase.database();
                console.log('‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω');
            } catch (error) {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ Firebase:', error);
            }
        }

        const App = () => {
            const [currentUser, setCurrentUser] = useState(null);
            const [messages, setMessages] = useState([]);
            const [users, setUsers] = useState([]);
            const [messageText, setMessageText] = useState('');
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [isOnline, setIsOnline] = useState(true);
            const messagesEndRef = useRef(null);
            const userActivityInterval = useRef(null);

            // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–∫—Ä—É—Ç–∫–∞
            const scrollToBottom = () => {
                messagesEndRef.current?.scrollIntoView({ behavior: 'smooth' });
            };

            useEffect(() => {
                scrollToBottom();
            }, [messages]);

            // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Firebase
            useEffect(() => {
                if (!isConfigured) {
                    setError('‚ö†Ô∏è Firebase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω! –°–º–æ—Ç—Ä–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –≤ README.md');
                }
            }, []);

            // –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ–Ω–ª–∞–π–Ω —Å—Ç–∞—Ç—É—Å–∞
            useEffect(() => {
                if (!database) return;

                const connectedRef = database.ref('.info/connected');
                connectedRef.on('value', (snap) => {
                    setIsOnline(snap.val() === true);
                });

                return () => connectedRef.off();
            }, []);

            // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            useEffect(() => {
                if (!database || !currentUser) return;

                const messagesRef = database.ref('messages');
                
                const handleMessages = (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const messagesList = Object.entries(data)
                            .map(([key, value]) => ({ id: key, ...value }))
                            .sort((a, b) => a.timestamp - b.timestamp)
                            .slice(-100); // –ü–æ—Å–ª–µ–¥–Ω–∏–µ 100 —Å–æ–æ–±—â–µ–Ω–∏–π
                        setMessages(messagesList);
                    } else {
                        setMessages([]);
                    }
                };

                messagesRef.on('value', handleMessages);

                return () => messagesRef.off('value', handleMessages);
            }, [currentUser]);

            // –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
            useEffect(() => {
                if (!database || !currentUser) return;

                const usersRef = database.ref('users');
                
                const handleUsers = (snapshot) => {
                    const data = snapshot.val();
                    if (data) {
                        const now = Date.now();
                        const usersList = Object.entries(data)
                            .map(([key, value]) => ({ id: key, ...value }))
                            .filter(u => (now - u.lastActive) < 300000) // –ê–∫—Ç–∏–≤–Ω—ã–µ –∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 5 –º–∏–Ω—É—Ç
                            .sort((a, b) => a.joinedAt - b.joinedAt);
                        setUsers(usersList);
                    } else {
                        setUsers([]);
                    }
                };

                usersRef.on('value', handleUsers);

                return () => usersRef.off('value', handleUsers);
            }, [currentUser]);

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            useEffect(() => {
                if (!database || !currentUser) return;

                const updateActivity = async () => {
                    try {
                        const userRef = database.ref(`users/${currentUser}`);
                        await userRef.update({
                            lastActive: Date.now()
                        });
                    } catch (err) {
                        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏:', err);
                    }
                };

                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 10 —Å–µ–∫—É–Ω–¥
                updateActivity();
                userActivityInterval.current = setInterval(updateActivity, 10000);

                return () => {
                    if (userActivityInterval.current) {
                        clearInterval(userActivityInterval.current);
                    }
                };
            }, [currentUser]);

            // –í—Ö–æ–¥ –≤ —á–∞—Ç
            const handleLogin = async (name) => {
                if (!name.trim()) {
                    setError('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è');
                    return;
                }

                if (!isConfigured || !database) {
                    setError('Firebase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω. –°–º–æ—Ç—Ä–∏—Ç–µ README.md –¥–ª—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π.');
                    return;
                }

                setLoading(true);
                setError('');
                
                try {
                    const userName = name.trim();
                    const usersRef = database.ref('users');
                    
                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–Ω—è—Ç–æ –ª–∏ –∏–º—è
                    const snapshot = await usersRef.once('value');
                    const existingUsers = snapshot.val() || {};
                    
                    if (existingUsers[userName]) {
                        const now = Date.now();
                        const lastActive = existingUsers[userName].lastActive || 0;
                        
                        // –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–µ–Ω (–º–µ–Ω—å—à–µ 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥)
                        if ((now - lastActive) < 300000) {
                            setError('–≠—Ç–æ –∏–º—è —É–∂–µ –∑–∞–Ω—è—Ç–æ. –í—ã–±–µ—Ä–∏—Ç–µ –¥—Ä—É–≥–æ–µ.');
                            setLoading(false);
                            return;
                        }
                    }

                    // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    await usersRef.child(userName).set({
                        name: userName,
                        joinedAt: Date.now(),
                        lastActive: Date.now()
                    });

                    // –°–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—Ö–æ–¥–µ
                    const messagesRef = database.ref('messages');
                    await messagesRef.push({
                        author: '–°–∏—Å—Ç–µ–º–∞',
                        text: `${userName} –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–∏–ª—Å—è –∫ —á–∞—Ç—É`,
                        timestamp: Date.now(),
                        isSystem: true
                    });

                    setCurrentUser(userName);
                } catch (err) {
                    setError('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ –≤ —á–∞—Ç: ' + err.message);
                    console.error('–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞:', err);
                } finally {
                    setLoading(false);
                }
            };

            // –í—ã—Ö–æ–¥ –∏–∑ —á–∞—Ç–∞
            const handleLogout = async () => {
                if (!currentUser || !database) return;

                try {
                    // –°–∏—Å—Ç–µ–º–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –≤—ã—Ö–æ–¥–µ
                    const messagesRef = database.ref('messages');
                    await messagesRef.push({
                        author: '–°–∏—Å—Ç–µ–º–∞',
                        text: `${currentUser} –ø–æ–∫–∏–Ω—É–ª —á–∞—Ç`,
                        timestamp: Date.now(),
                        isSystem: true
                    });

                    // –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                    const userRef = database.ref(`users/${currentUser}`);
                    await userRef.remove();

                    setCurrentUser(null);
                    setMessages([]);
                    setUsers([]);
                } catch (err) {
                    console.error('–û—à–∏–±–∫–∞ –≤—ã—Ö–æ–¥–∞:', err);
                }
            };

            // –û—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
            const handleSendMessage = async () => {
                if (!messageText.trim() || !currentUser || !database) return;

                try {
                    const messagesRef = database.ref('messages');
                    await messagesRef.push({
                        author: currentUser,
                        text: messageText.trim(),
                        timestamp: Date.now(),
                        isSystem: false
                    });

                    setMessageText('');
                } catch (err) {
                    setError('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: ' + err.message);
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', err);
                }
            };

            const handleKeyPress = (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    handleSendMessage();
                }
            };

            const formatTime = (timestamp) => {
                const date = new Date(timestamp);
                return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
            };

            const getInitials = (name) => {
                return name.charAt(0).toUpperCase();
            };

            // –≠–∫—Ä–∞–Ω –≤—Ö–æ–¥–∞
            if (!currentUser) {
                return (
                    <LoginScreen 
                        onLogin={handleLogin} 
                        loading={loading}
                        error={error}
                        isConfigured={isConfigured}
                    />
                );
            }

            // –û—Å–Ω–æ–≤–Ω–æ–π —á–∞—Ç
            return (
                <div className="app-container">
                    <div className="header">
                        <h1>
                            <span>üí¨</span>
                            <span>–°–≤–æ–±–æ–¥–Ω—ã–π —á–∞—Ç –º–∏–ª–ª–∏–∞—Ä–¥–µ—Ä–æ–≤</span>
                            {!isOnline && (
                                <span style={{ 
                                    fontSize: '14px', 
                                    color: '#ff6b6b', 
                                    marginLeft: '15px',
                                    padding: '5px 10px',
                                    background: 'rgba(255,107,107,0.2)',
                                    borderRadius: '10px'
                                }}>
                                    ‚ö†Ô∏è –û—Ñ–ª–∞–π–Ω
                                </span>
                            )}
                        </h1>
                        <div style={{ display: 'flex', gap: '15px', alignItems: 'center' }}>
                            <div className="online-count">
                                üë• –û–Ω–ª–∞–π–Ω: {users.length}
                            </div>
                            <button className="logout-button" onClick={handleLogout}>
                                –í—ã–π—Ç–∏
                            </button>
                        </div>
                    </div>

                    <div className="chat-container">
                        <div className="sidebar">
                            <div className="sidebar-header">
                                <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏ —á–∞—Ç–∞</h3>
                                <div className="user-info">–í—ã: {currentUser}</div>
                            </div>
                            <div className="users-list">
                                {users.map((user) => (
                                    <div key={user.id} className="user-item">
                                        <div className="user-avatar">
                                            {getInitials(user.name)}
                                        </div>
                                        <div style={{ flex: 1 }}>
                                            <div style={{ fontWeight: '600', color: '#1a1a2e' }}>
                                                {user.name}
                                                {user.name === currentUser && ' (–í—ã)'}
                                            </div>
                                        </div>
                                        <div className="online-indicator" />
                                    </div>
                                ))}
                            </div>
                        </div>

                        <div className="main-chat">
                            <div className="messages-container">
                                {messages.length === 0 ? (
                                    <div className="empty-chat">
                                        <div className="empty-chat-icon">üí≠</div>
                                        <div>–ü–æ–∫–∞ –Ω–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–π</div>
                                        <div style={{ fontSize: '14px', marginTop: '5px' }}>
                                            –ù–∞—á–Ω–∏—Ç–µ –±–µ—Å–µ–¥—É!
                                        </div>
                                    </div>
                                ) : (
                                    messages.map((msg) => (
                                        <div 
                                            key={msg.id} 
                                            className={`message ${msg.author === currentUser ? 'own' : ''} ${msg.isSystem ? 'system' : ''}`}
                                        >
                                            {msg.isSystem ? (
                                                <div style={{ 
                                                    textAlign: 'center', 
                                                    color: '#999', 
                                                    fontSize: '14px',
                                                    fontStyle: 'italic'
                                                }}>
                                                    {msg.text}
                                                </div>
                                            ) : (
                                                <>
                                                    <div className="message-header">
                                                        <div className="message-avatar">
                                                            {getInitials(msg.author)}
                                                        </div>
                                                        <div className="message-author">
                                                            {msg.author}
                                                        </div>
                                                        <div className="message-time">
                                                            {formatTime(msg.timestamp)}
                                                        </div>
                                                    </div>
                                                    <div className="message-content">
                                                        {msg.text}
                                                    </div>
                                                </>
                                            )}
                                        </div>
                                    ))
                                )}
                                <div ref={messagesEndRef} />
                            </div>

                            {error && (
                                <div className="error-message">{error}</div>
                            )}

                            <div className="input-container">
                                <input
                                    type="text"
                                    className="message-input"
                                    placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ —Å–æ–æ–±—â–µ–Ω–∏–µ..."
                                    value={messageText}
                                    onChange={(e) => setMessageText(e.target.value)}
                                    onKeyPress={handleKeyPress}
                                    disabled={!isOnline}
                                />
                                <button 
                                    className="send-button"
                                    onClick={handleSendMessage}
                                    disabled={!messageText.trim() || !isOnline}
                                >
                                    –û—Ç–ø—Ä–∞–≤–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const LoginScreen = ({ onLogin, loading, error, isConfigured }) => {
            const [name, setName] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                onLogin(name);
            };

            return (
                <div className="app-container">
                    <div className="header">
                        <h1>
                            <span>üí¨</span>
                            <span>–°–≤–æ–±–æ–¥–Ω—ã–π —á–∞—Ç –º–∏–ª–ª–∏–∞—Ä–¥–µ—Ä–æ–≤</span>
                        </h1>
                    </div>
                    <div className="login-container">
                        <div className="login-box">
                            <h2>–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h2>
                            <p>–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è –¥–ª—è –≤—Ö–æ–¥–∞ –≤ —á–∞—Ç</p>
                            
                            {!isConfigured && (
                                <div style={{ 
                                    padding: '15px', 
                                    background: '#fff3cd', 
                                    border: '2px solid #ffc107',
                                    borderRadius: '10px', 
                                    marginBottom: '20px',
                                    fontSize: '13px',
                                    textAlign: 'left'
                                }}>
                                    <strong>‚ö†Ô∏è Firebase –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω!</strong>
                                    <div style={{ marginTop: '10px' }}>
                                        1. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ–µ–∫—Ç –Ω–∞ <a href="https://console.firebase.google.com" target="_blank">Firebase Console</a><br/>
                                        2. –í–∫–ª—é—á–∏—Ç–µ Realtime Database<br/>
                                        3. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ index.html<br/>
                                        4. –°–º–æ—Ç—Ä–∏—Ç–µ FIREBASE_SETUP.md –¥–ª—è –¥–µ—Ç–∞–ª–µ–π
                                    </div>
                                </div>
                            )}
                            
                            {error && (
                                <div className="error-message">{error}</div>
                            )}
                            
                            <form onSubmit={handleSubmit}>
                                <div className="input-group">
                                    <input
                                        type="text"
                                        placeholder="–í–∞—à–µ –∏–º—è"
                                        value={name}
                                        onChange={(e) => setName(e.target.value)}
                                        maxLength={20}
                                        disabled={loading || !isConfigured}
                                        autoFocus
                                    />
                                </div>
                                <button 
                                    type="submit" 
                                    className="btn-primary"
                                    disabled={loading || !name.trim() || !isConfigured}
                                >
                                    {loading ? '–í—Ö–æ–¥...' : '–í–æ–π—Ç–∏ –≤ —á–∞—Ç'}
                                </button>
                            </form>
                            
                            <div style={{ marginTop: '20px', padding: '15px', background: 'rgba(76, 175, 80, 0.1)', borderRadius: '10px', fontSize: '13px', color: '#2e7d32' }}>
                                <strong>‚úÖ –ù–ê–°–¢–û–Ø–©–ò–ô REAL-TIME –ß–ê–¢</strong>
                                <div style={{ marginTop: '8px' }}>
                                    ‚Ä¢ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –≤–∏–¥—è—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –¥—Ä—É–≥ –¥—Ä—É–≥–∞<br/>
                                    ‚Ä¢ –†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ª—é–±—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö<br/>
                                    ‚Ä¢ –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏<br/>
                                    ‚Ä¢ –ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —Ö–æ—Å—Ç–∏–Ω–≥ –Ω–∞ Firebase
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>

</body>
</html>

<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, #d4af37 0%, #f4e4a6 100%);
            color: #1a1a2e;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(212, 175, 55, 0.3);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.8;
        }

        .main-menu {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-btn {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            border: 2px solid #d4af37;
            color: #f4e4a6;
            padding: 30px;
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
            font-size: 1.2em;
        }

        .menu-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(212, 175, 55, 0.5);
            background: linear-gradient(135deg, #34495e 0%, #2c3e50 100%);
        }

        .menu-btn i {
            font-size: 2em;
            display: block;
            margin-bottom: 10px;
        }

        .section {
            display: none;
            background: rgba(44, 62, 80, 0.5);
            padding: 30px;
            border-radius: 15px;
            border: 2px solid #d4af37;
            backdrop-filter: blur(10px);
        }

        .section.active {
            display: block;
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            color: #d4af37;
            font-size: 2em;
            margin-bottom: 20px;
            border-bottom: 3px solid #d4af37;
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            color: #d4af37;
            margin-bottom: 8px;
            font-weight: bold;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: rgba(26, 26, 46, 0.8);
            border: 2px solid #34495e;
            border-radius: 8px;
            color: #e0e0e0;
            font-size: 1em;
            transition: all 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #d4af37;
            box-shadow: 0 0 15px rgba(212, 175, 55, 0.3);
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
            margin: 5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #d4af37 0%, #f4e4a6 100%);
            color: #1a1a2e;
            font-weight: bold;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.5);
        }

        .btn-secondary {
            background: #34495e;
            color: #f4e4a6;
            border: 2px solid #d4af37;
        }

        .btn-secondary:hover {
            background: #2c3e50;
        }

        .btn-danger {
            background: #e74c3c;
            color: white;
        }

        .btn-danger:hover {
            background: #c0392b;
        }

        .card {
            background: rgba(26, 26, 46, 0.6);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #34495e;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .card:hover {
            border-color: #d4af37;
            box-shadow: 0 5px 20px rgba(212, 175, 55, 0.2);
        }

        .radio-group {
            display: flex;
            gap: 20px;
            margin: 10px 0;
        }

        .radio-group label {
            display: flex;
            align-items: center;
            cursor: pointer;
            padding: 10px 20px;
            background: rgba(52, 73, 94, 0.5);
            border: 2px solid #34495e;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .radio-group input[type="radio"] {
            margin-right: 10px;
            width: auto;
        }

        .radio-group label:hover {
            border-color: #d4af37;
            background: rgba(52, 73, 94, 0.8);
        }

        .radio-group input[type="radio"]:checked + span {
            color: #d4af37;
            font-weight: bold;
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin: 10px 0;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            padding: 8px;
            background: rgba(52, 73, 94, 0.3);
            border-radius: 5px;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 8px;
            width: auto;
        }

        .detail-card {
            background: rgba(26, 26, 46, 0.8);
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #d4af37;
            margin-bottom: 20px;
            position: relative;
        }

        .detail-header {
            color: #d4af37;
            font-size: 1.3em;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 15px;
        }

        .operation-item {
            background: rgba(52, 73, 94, 0.5);
            padding: 10px;
            border-radius: 5px;
            margin: 5px 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .report {
            background: white;
            color: #000;
            padding: 40px;
            border-radius: 10px;
            max-width: 900px;
            margin: 0 auto;
        }

        .report-header {
            text-align: center;
            border-bottom: 3px solid #d4af37;
            padding-bottom: 20px;
            margin-bottom: 30px;
        }

        .report-section {
            margin: 20px 0;
        }

        .report-section h3 {
            color: #d4af37;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .report-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }

        .report-table th,
        .report-table td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }

        .report-table th {
            background: #d4af37;
            color: #1a1a2e;
            font-weight: bold;
        }

        .report-total {
            background: #f4e4a6;
            padding: 20px;
            border-radius: 10px;
            margin-top: 30px;
            border: 2px solid #d4af37;
        }

        .report-total h3 {
            color: #1a1a2e;
            font-size: 1.5em;
            margin-bottom: 10px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin: 5px 0;
            font-size: 1.1em;
        }

        .total-row.grand {
            font-size: 1.5em;
            font-weight: bold;
            color: #1a1a2e;
            border-top: 2px solid #d4af37;
            padding-top: 10px;
            margin-top: 10px;
        }

        .list-item {
            background: rgba(26, 26, 46, 0.6);
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #34495e;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .list-item:hover {
            border-color: #d4af37;
        }

        .list-item-info {
            flex: 1;
        }

        .list-item-actions {
            display: flex;
            gap: 10px;
        }

        .badge {
            display: inline-block;
            padding: 5px 10px;
            background: #d4af37;
            color: #1a1a2e;
            border-radius: 5px;
            font-size: 0.85em;
            margin: 2px;
        }

        .back-btn {
            margin-bottom: 20px;
        }

        @media print {
            body {
                background: white;
            }
            .section {
                background: white;
                border: none;
                padding: 0;
            }
            .btn, .back-btn {
                display: none;
            }
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #999;
        }

        .empty-state i {
            font-size: 4em;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
        }

        .specs-list {
            list-style: none;
            padding: 0;
        }

        .specs-list li {
            padding: 5px 0;
            border-bottom: 1px solid rgba(212, 175, 55, 0.2);
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .alert-info {
            background: rgba(52, 152, 219, 0.2);
            border: 2px solid #3498db;
            color: #3498db;
        }

        .alert-success {
            background: rgba(46, 204, 113, 0.2);
            border: 2px solid #2ecc71;
            color: #2ecc71;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ –ö–∞–ª—å–∫—É–ª—è—Ç–æ—Ä –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–∞</h1>
            <p>–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π</p>
        </div>

        <!-- –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é -->
        <div id="mainMenu" class="main-menu">
            <div class="menu-btn" onclick="showSection('newProject')">
                <i>üìã</i>
                <div>–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</div>
            </div>
            <div class="menu-btn" onclick="showSection('projectsList')">
                <i>üìÅ</i>
                <div>–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</div>
            </div>
            <div class="menu-btn" onclick="showSection('workers')">
                <i>üë∑</i>
                <div>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏</div>
            </div>
            <div class="menu-btn" onclick="showSection('materials')">
                <i>üî©</i>
                <div>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã</div>
            </div>
            <div class="menu-btn" onclick="exportFullDatabase()">
                <i>üíæ</i>
                <div>–≠–∫—Å–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</div>
            </div>
            <div class="menu-btn" onclick="importFullDatabase()">
                <i>üì•</i>
                <div>–ò–º–ø–æ—Ä—Ç –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö</div>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è: –ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç -->
        <div id="newProject" class="section">
            <button class="btn btn-secondary back-btn" onclick="showSection('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            <h2 class="section-title">–ù–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç</h2>

            <div class="form-group">
                <label>–ù–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞:</label>
                <input type="text" id="projectName" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–µ—Ç–∞–ª—å ‚Ññ5">
            </div>

            <div class="form-group">
                <label>–†–µ–∂–∏–º —Ä–∞—Å—á–µ—Ç–∞:</label>
                <div class="radio-group">
                    <label>
                        <input type="radio" name="calcMode" value="time" checked onchange="toggleCalcMode()">
                        <span>üïê –ü–æ –≤—Ä–µ–º–µ–Ω–∏</span>
                    </label>
                    <label>
                        <input type="radio" name="calcMode" value="mass" onchange="toggleCalcMode()">
                        <span>‚öñÔ∏è –ü–æ –º–∞—Å—Å–µ –∑–∞–≥–æ—Ç–æ–≤–∫–∏</span>
                    </label>
                </div>
            </div>

            <!-- –†–∞—Å—á–µ—Ç –ø–æ –≤—Ä–µ–º–µ–Ω–∏ -->
            <div id="timeModeSection">
                <div class="card">
                    <h3 style="color: #d4af37; margin-bottom: 15px;">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –≤—Ä–µ–º–µ–Ω–∏</h3>
                    <div class="form-group">
                        <label>–°—Ç–æ–∏–º–æ—Å—Ç—å —á–∞—Å–∞ —Ä–∞–±–æ—Ç—ã (‚ÇΩ/—á–∞—Å):</label>
                        <input type="number" id="hourRate" value="500" min="0">
                    </div>
                    <div class="form-group">
                        <label>–û–±—â–µ–µ –≤—Ä–µ–º—è –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è (—á–∞—Å–æ–≤):</label>
                        <input type="number" id="totalTime" value="0" min="0" step="0.1">
                    </div>
                    <div class="alert alert-info">
                        üí° –ò–ª–∏ –¥–æ–±–∞–≤—å—Ç–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ –Ω–∏–∂–µ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ —É—á–µ—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏
                    </div>
                </div>
            </div>

            <!-- –†–∞—Å—á–µ—Ç –ø–æ –º–∞—Å—Å–µ -->
            <div id="massModeSection" style="display: none;">
                <div class="card">
                    <h3 style="color: #d4af37; margin-bottom: 15px;">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—á–µ—Ç–∞</h3>
                    <div class="grid-2">
                        <div class="form-group">
                            <label>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç –Ω–∞—Ü–µ–Ω–∫–∏ –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª:</label>
                            <input type="number" id="materialCoeff" value="1.5" min="1" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è:</label>
                            <input type="number" id="complexityCoeff" value="1.2" min="1" step="0.1">
                        </div>
                    </div>
                </div>
            </div>

            <!-- –î–µ—Ç–∞–ª–∏ -->
            <div class="card">
                <h3 style="color: #d4af37; margin-bottom: 15px;">–î–µ—Ç–∞–ª–∏</h3>
                <div id="detailsList"></div>
                <button class="btn btn-primary" onclick="addDetail()">+ –î–æ–±–∞–≤–∏—Ç—å –¥–µ—Ç–∞–ª—å</button>
            </div>

            <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã -->
            <div class="card">
                <h3 style="color: #d4af37; margin-bottom: 15px;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã</h3>
                <div id="expensesList"></div>
                <button class="btn btn-primary" onclick="addExpense()">+ –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å—Ö–æ–¥</button>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" style="font-size: 1.2em; padding: 15px 50px;" onclick="calculateProject()">
                    üìä –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
                </button>
            </div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è: –û—Ç—á–µ—Ç -->
        <div id="reportSection" class="section">
            <button class="btn btn-secondary back-btn" onclick="showSection('newProject')">‚Üê –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø—Ä–æ–µ–∫—Ç—É</button>
            <button class="btn btn-secondary" onclick="window.print()">üñ®Ô∏è –ü–µ—á–∞—Ç—å</button>
            <button class="btn btn-secondary" onclick="saveProject()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–æ–µ–∫—Ç</button>
            <button class="btn btn-secondary" onclick="exportToJSON()">üìÅ –≠–∫—Å–ø–æ—Ä—Ç JSON</button>

            <div id="reportContent" class="report"></div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è: –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
        <div id="projectsList" class="section">
            <button class="btn btn-secondary back-btn" onclick="showSection('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            <button class="btn btn-primary" onclick="importProject()">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø—Ä–æ–µ–∫—Ç –∏–∑ JSON</button>
            <h2 class="section-title">–ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</h2>
            <div id="projectsListContent"></div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è: –°–æ—Ç—Ä—É–¥–Ω–∏–∫–∏ -->
        <div id="workers" class="section">
            <button class="btn btn-secondary back-btn" onclick="showSection('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            <button class="btn btn-primary" onclick="exportWorkers()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã</button>
            <button class="btn btn-primary" onclick="importWorkers()">üì• –ò–º–ø–æ—Ä—Ç –±–∞–∑—ã</button>
            <h2 class="section-title">–ë–∞–∑–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤</h2>

            <div class="card">
                <h3 style="color: #d4af37; margin-bottom: 15px;">–î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h3>
                <div class="grid-2">
                    <div class="form-group">
                        <label>–§–∞–º–∏–ª–∏—è:</label>
                        <input type="text" id="workerLastName">
                    </div>
                    <div class="form-group">
                        <label>–ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ:</label>
                        <input type="text" id="workerFirstName">
                    </div>
                </div>
                <div class="form-group">
                    <label>–°—Ç–∞–≤–∫–∞ (‚ÇΩ/—á–∞—Å):</label>
                    <input type="number" id="workerRate" value="500" min="0">
                </div>
                <div class="form-group">
                    <label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏:</label>
                    <div class="checkbox-group" id="specialtiesCheckboxes"></div>
                </div>
                <button class="btn btn-primary" onclick="addWorker()">+ –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</button>
            </div>

            <div id="workersList"></div>
        </div>

        <!-- –°–µ–∫—Ü–∏—è: –ú–∞—Ç–µ—Ä–∏–∞–ª—ã -->
        <div id="materials" class="section">
            <button class="btn btn-secondary back-btn" onclick="showSection('mainMenu')">‚Üê –ù–∞–∑–∞–¥</button>
            <button class="btn btn-primary" onclick="exportMaterials()">üì§ –≠–∫—Å–ø–æ—Ä—Ç –±–∞–∑—ã</button>
            <button class="btn btn-primary" onclick="importMaterials()">üì• –ò–º–ø–æ—Ä—Ç –±–∞–∑—ã</button>
            <h2 class="section-title">–ë–∞–∑–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤</h2>

            <div class="card">
                <h3 style="color: #d4af37; margin-bottom: 15px;">–î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</h3>
                <div class="grid-3">
                    <div class="form-group">
                        <label>–ù–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞:</label>
                        <input type="text" id="materialName">
                    </div>
                    <div class="form-group">
                        <label>–¶–µ–Ω–∞ (‚ÇΩ/–∫–≥):</label>
                        <input type="number" id="materialPrice" value="45" min="0" step="0.01">
                    </div>
                    <div class="form-group">
                        <label>–ü–ª–æ—Ç–Ω–æ—Å—Ç—å (–≥/—Å–º¬≥):</label>
                        <input type="number" id="materialDensity" value="7.85" min="0" step="0.01">
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addMaterial()">+ –î–æ–±–∞–≤–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª</button>
            </div>

            <div id="materialsList"></div>
        </div>
    </div>

    <script>
        // –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
        const SPECIALTIES = [
            '–°–ª–µ—Å–∞—Ä—å',
            '–¢–æ–∫–∞—Ä—å',
            '–§—Ä–µ–∑–µ—Ä–æ–≤—â–∏–∫',
            '–ó–∞—Ç–æ—á–Ω–∏–∫',
            '–®–ª–∏—Ñ–æ–≤—â–∏–∫',
            '–†–∞—Å—Ç–æ—á–Ω–∏–∫',
            '–ó—É–±–æ–¥–æ–ª–±–µ–∂–Ω–∏–∫',
            '–ó—É–±–æ—Ñ—Ä–µ–∑–µ—Ä–æ–≤—â–∏–∫'
        ];

        const BLANK_TYPES = {
            circle: { name: '–ö—Ä—É–≥', fields: ['diameter', 'length'] },
            square: { name: '–ö–≤–∞–¥—Ä–∞—Ç', fields: ['side', 'length'] },
            tube: { name: '–¢—Ä—É–±–∞', fields: ['outerDiameter', 'innerDiameter', 'length'] },
            hexagon: { name: '–®–µ—Å—Ç–∏–≥—Ä–∞–Ω–Ω–∏–∫', fields: ['side', 'length'] },
            corner: { name: '–£–≥–æ–ª–æ–∫', fields: ['width', 'height', 'thickness', 'length'] },
            sheet: { name: '–õ–∏—Å—Ç', fields: ['width', 'height', 'thickness'] }
        };

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        let currentProject = {
            name: '',
            mode: 'time',
            hourRate: 500,
            totalTime: 0,
            materialCoeff: 1.5,
            complexityCoeff: 1.2,
            details: [],
            expenses: []
        };

        // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ localStorage
        function loadData() {
            const workers = localStorage.getItem('workers');
            const materials = localStorage.getItem('materials');
            const projects = localStorage.getItem('projects');

            if (!workers) {
                const defaultWorkers = [
                    { id: 1, lastName: '–ò–≤–∞–Ω–æ–≤', firstName: '–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á', rate: 500, specialties: ['–¢–æ–∫–∞—Ä—å', '–°–ª–µ—Å–∞—Ä—å'] },
                    { id: 2, lastName: '–ü–µ—Ç—Ä–æ–≤', firstName: '–ü–µ—Ç—Ä –ü–µ—Ç—Ä–æ–≤–∏—á', rate: 550, specialties: ['–§—Ä–µ–∑–µ—Ä–æ–≤—â–∏–∫'] }
                ];
                localStorage.setItem('workers', JSON.stringify(defaultWorkers));
            }

            if (!materials) {
                const defaultMaterials = [
                    { id: 1, name: '–°—Ç–∞–ª—å –æ–±—ã—á–Ω–∞—è', price: 45, density: 7.85 },
                    { id: 2, name: '–°—Ç–∞–ª—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞–ª—å–Ω–∞—è', price: 120, density: 7.85 },
                    { id: 3, name: '–ê–ª—é–º–∏–Ω–∏–π', price: 180, density: 2.7 },
                    { id: 4, name: '–ë—Ä–æ–Ω–∑–∞', price: 550, density: 8.8 },
                    { id: 5, name: '–ö–∞–ø—Ä–æ–ª–æ–Ω', price: 280, density: 1.15 },
                    { id: 6, name: '–§—Ç–æ—Ä–æ–ø–ª–∞—Å—Ç', price: 650, density: 2.2 }
                ];
                localStorage.setItem('materials', JSON.stringify(defaultMaterials));
            }

            if (!projects) {
                localStorage.setItem('projects', JSON.stringify([]));
            }
        }

        function getWorkers() {
            return JSON.parse(localStorage.getItem('workers') || '[]');
        }

        function getMaterials() {
            return JSON.parse(localStorage.getItem('materials') || '[]');
        }

        function getProjects() {
            return JSON.parse(localStorage.getItem('projects') || '[]');
        }

        function saveWorkers(workers) {
            localStorage.setItem('workers', JSON.stringify(workers));
        }

        function saveMaterials(materials) {
            localStorage.setItem('materials', JSON.stringify(materials));
        }

        function saveProjects(projects) {
            localStorage.setItem('projects', JSON.stringify(projects));
        }

        function importProject() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const project = JSON.parse(event.target.result);
                        const projects = getProjects();
                        project.id = Date.now();
                        project.date = new Date().toLocaleDateString('ru-RU');
                        projects.push(project);
                        saveProjects(projects);
                        alert('‚úÖ –ü—Ä–æ–µ–∫—Ç —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                        renderProjectsList();
                    } catch (err) {
                        alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ' + err.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        function exportFullDatabase() {
            const data = {
                version: '2.0',
                exportDate: new Date().toISOString(),
                workers: getWorkers(),
                materials: getMaterials(),
                projects: getProjects()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `full_database_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('‚úÖ –ü–æ–ª–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞!\n\n–í–∫–ª—é—á–µ–Ω–æ:\n' +
                  `- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${data.workers.length}\n` +
                  `- –ú–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: ${data.materials.length}\n` +
                  `- –ü—Ä–æ–µ–∫—Ç–æ–≤: ${data.projects.length}`);
        }

        function importFullDatabase() {
            if (!confirm('‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï!\n\n–≠—Ç–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–º–µ–Ω–∏—Ç –í–°–ï —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ:\n' +
                        '- –í—Å–µ—Ö —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤\n' +
                        '- –í—Å–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã\n' +
                        '- –í—Å–µ –ø—Ä–æ–µ–∫—Ç—ã\n\n' +
                        '–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                return;
            }

            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
                        if (!data.workers || !data.materials) {
                            throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞ –ø–æ–ª–Ω–æ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö');
                        }

                        // –û–±–µ—Å–ø–µ—á–∏–≤–∞–µ–º –Ω–∞–ª–∏—á–∏–µ –ø–ª–æ—Ç–Ω–æ—Å—Ç–∏ —É –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤
                        data.materials.forEach(m => {
                            if (!m.density) m.density = 7.85;
                        });

                        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Å–µ –¥–∞–Ω–Ω—ã–µ
                        saveWorkers(data.workers || []);
                        saveMaterials(data.materials || []);
                        saveProjects(data.projects || []);
                        
                        alert('‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö —É—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–∞!\n\n' +
                              `–ó–∞–≥—Ä—É–∂–µ–Ω–æ:\n` +
                              `- –°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${data.workers.length}\n` +
                              `- –ú–∞—Ç–µ—Ä–∏–∞–ª–æ–≤: ${data.materials.length}\n` +
                              `- –ü—Ä–æ–µ–∫—Ç–æ–≤: ${data.projects ? data.projects.length : 0}`);
                        
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –Ω–∞—Ö–æ–¥–∏–º—Å—è –Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö
                        if (document.getElementById('workers').classList.contains('active')) {
                            renderWorkers();
                        }
                        if (document.getElementById('materials').classList.contains('active')) {
                            renderMaterials();
                        }
                        if (document.getElementById('projectsList').classList.contains('active')) {
                            renderProjectsList();
                        }
                    } catch (err) {
                        alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ' + err.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // –ù–∞–≤–∏–≥–∞—Ü–∏—è
        function showSection(sectionId) {
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById('mainMenu').style.display = 'none';

            if (sectionId === 'mainMenu') {
                document.getElementById('mainMenu').style.display = 'grid';
            } else {
                document.getElementById(sectionId).classList.add('active');
            }

            if (sectionId === 'workers') {
                renderWorkers();
            } else if (sectionId === 'materials') {
                renderMaterials();
            } else if (sectionId === 'projectsList') {
                renderProjectsList();
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ä–µ–∂–∏–º–∞ —Ä–∞—Å—á–µ—Ç–∞
        function toggleCalcMode() {
            const mode = document.querySelector('input[name="calcMode"]:checked').value;
            currentProject.mode = mode;
            
            if (mode === 'time') {
                document.getElementById('timeModeSection').style.display = 'block';
                document.getElementById('massModeSection').style.display = 'none';
            } else {
                document.getElementById('timeModeSection').style.display = 'none';
                document.getElementById('massModeSection').style.display = 'block';
            }
        }

        // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥–µ—Ç–∞–ª–∏
        function addDetail() {
            const detail = {
                id: Date.now(),
                name: '',
                purpose: '',
                quantity: 1,
                blankType: 'circle',
                dimensions: {},
                material: null,
                complexity: 1,
                operations: []
            };

            currentProject.details.push(detail);
            renderDetails();
        }

        function renderDetails() {
            const container = document.getElementById('detailsList');
            const materials = getMaterials();
            const workers = getWorkers();

            container.innerHTML = currentProject.details.map((detail, index) => {
                const blankType = BLANK_TYPES[detail.blankType];
                const mass = calculateBlankMass(detail);
                const materialCost = detail.material && mass ? (mass * detail.material.price).toFixed(2) : 0;

                return `
                    <div class="detail-card">
                        <div class="detail-header">
                            <span>–î–µ—Ç–∞–ª—å #${index + 1}</span>
                            <button class="btn btn-danger" onclick="removeDetail(${detail.id})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>

                        <div class="grid-2">
                            <div class="form-group">
                                <label>–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ –¥–µ—Ç–∞–ª–∏:</label>
                                <input type="text" value="${detail.name || ''}" 
                                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–∞–ª –ø—Ä–∏–≤–æ–¥–Ω–æ–π"
                                    onchange="updateDetailName(${detail.id}, this.value)">
                            </div>

                            <div class="form-group">
                                <label>–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:</label>
                                <input type="text" value="${detail.purpose || ''}" 
                                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –î–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –∫—Ä—É—Ç—è—â–µ–≥–æ –º–æ–º–µ–Ω—Ç–∞"
                                    onchange="updateDetailPurpose(${detail.id}, this.value)">
                            </div>
                        </div>

                        <div class="grid-2">
                            <div class="form-group">
                                <label>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ (—à—Ç):</label>
                                <input type="number" value="${detail.quantity}" min="1" 
                                    onchange="updateDetailQuantity(${detail.id}, this.value)">
                            </div>

                            <div class="form-group">
                                <label>–¢–∏–ø –∑–∞–≥–æ—Ç–æ–≤–∫–∏:</label>
                                <select onchange="updateDetailBlankType(${detail.id}, this.value)">
                                    ${Object.keys(BLANK_TYPES).map(key => 
                                        `<option value="${key}" ${detail.blankType === key ? 'selected' : ''}>
                                            ${BLANK_TYPES[key].name}
                                        </option>`
                                    ).join('')}
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>–†–∞–∑–º–µ—Ä—ã –∑–∞–≥–æ—Ç–æ–≤–∫–∏:</label>
                            <div class="grid-3">
                                ${renderDimensionFields(detail, blankType)}
                            </div>
                        </div>

                        <div class="grid-2">
                            <div class="form-group">
                                <label>–ú–∞—Ç–µ—Ä–∏–∞–ª:</label>
                                <select onchange="updateDetailMaterial(${detail.id}, this.value)">
                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –º–∞—Ç–µ—Ä–∏–∞–ª</option>
                                    ${materials.map(m => 
                                        `<option value="${m.id}" ${detail.material?.id == m.id ? 'selected' : ''}>
                                            ${m.name} (${m.price} ‚ÇΩ/–∫–≥)
                                        </option>`
                                    ).join('')}
                                </select>
                            </div>

                            <div class="form-group">
                                <label>–ö–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç–∏:</label>
                                <input type="number" value="${detail.complexity}" min="1" step="0.1"
                                    onchange="updateDetailComplexity(${detail.id}, this.value)">
                            </div>
                        </div>

                        ${mass ? `
                            <div class="alert alert-success">
                                ‚öñÔ∏è –ú–∞—Å—Å–∞ –∑–∞–≥–æ—Ç–æ–≤–∫–∏: <strong>${mass.toFixed(2)} –∫–≥</strong>
                                ${materialCost > 0 ? ` | üí∞ –°—Ç–æ–∏–º–æ—Å—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª–∞: <strong>${materialCost} ‚ÇΩ</strong>` : ''}
                            </div>
                        ` : ''}

                        <div class="form-group">
                            <label>–û–ø–µ—Ä–∞—Ü–∏–∏ –∏ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª–∏:</label>
                            <div id="operations-${detail.id}">
                                ${renderOperations(detail, workers)}
                            </div>
                            <button class="btn btn-secondary" onclick="addOperation(${detail.id})">
                                + –î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderDimensionFields(detail, blankType) {
            const fields = blankType.fields;
            const labels = {
                diameter: '–î–∏–∞–º–µ—Ç—Ä (–º–º)',
                outerDiameter: '–í–Ω–µ—à–Ω–∏–π √ò (–º–º)',
                innerDiameter: '–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π √ò (–º–º)',
                side: '–°—Ç–æ—Ä–æ–Ω–∞ (–º–º)',
                width: '–®–∏—Ä–∏–Ω–∞ (–º–º)',
                height: '–í—ã—Å–æ—Ç–∞ (–º–º)',
                thickness: '–¢–æ–ª—â–∏–Ω–∞ (–º–º)',
                length: '–î–ª–∏–Ω–∞ (–º–º)'
            };

            return fields.map(field => `
                <div>
                    <label style="font-size: 0.9em; color: #aaa;">${labels[field]}:</label>
                    <input type="number" value="${detail.dimensions[field] || ''}" min="0"
                        onchange="updateDetailDimension(${detail.id}, '${field}', this.value)">
                </div>
            `).join('');
        }

        function renderOperations(detail, workers) {
            if (detail.operations.length === 0) {
                return '<p style="color: #999; padding: 10px;">–û–ø–µ—Ä–∞—Ü–∏–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã</p>';
            }

            return detail.operations.map((op, idx) => `
                <div class="operation-item">
                    <div style="flex: 1;">
                        <strong>${op.specialty}</strong> - ${op.worker.lastName} ${op.worker.firstName}
                        <br><small style="color: #aaa;">${op.hours} —á √ó ${op.worker.rate} ‚ÇΩ/—á = ${(op.hours * op.worker.rate).toFixed(2)} ‚ÇΩ</small>
                    </div>
                    <button class="btn btn-danger" onclick="removeOperation(${detail.id}, ${idx})">√ó</button>
                </div>
            `).join('');
        }

        function addOperation(detailId) {
            const detail = currentProject.details.find(d => d.id === detailId);
            const workers = getWorkers();

            // –°–æ–∑–¥–∞–µ–º —Ñ–æ—Ä–º—É –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–ø–µ—Ä–∞—Ü–∏–∏
            const formHtml = `
                <div style="background: rgba(26,26,46,0.9); padding: 20px; border-radius: 10px; border: 2px solid #d4af37;">
                    <h3 style="color: #d4af37; margin-bottom: 15px;">–î–æ–±–∞–≤–∏—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é</h3>
                    
                    <div class="form-group">
                        <label>–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å:</label>
                        <select id="opSpecialty" onchange="filterWorkersBySpecialty()">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</option>
                            ${SPECIALTIES.map(s => `<option value="${s}">${s}</option>`).join('')}
                        </select>
                    </div>

                    <div class="form-group">
                        <label>–†–∞–±–æ—Ç–Ω–∏–∫:</label>
                        <select id="opWorker">
                            <option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã (—á–∞—Å–æ–≤):</label>
                        <input type="number" id="opHours" min="0" step="0.1" value="1">
                    </div>

                    <div style="text-align: center; margin-top: 15px;">
                        <button class="btn btn-primary" onclick="saveOperation(${detailId})">–î–æ–±–∞–≤–∏—Ç—å</button>
                        <button class="btn btn-secondary" onclick="cancelOperation()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ä–º—É –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
            const modal = document.createElement('div');
            modal.id = 'operationModal';
            modal.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; z-index: 1000;';
            modal.innerHTML = `<div style="max-width: 500px; width: 90%;">${formHtml}</div>`;
            document.body.appendChild(modal);
        }

        function filterWorkersBySpecialty() {
            const specialty = document.getElementById('opSpecialty').value;
            const workerSelect = document.getElementById('opWorker');
            const workers = getWorkers();

            if (!specialty) {
                workerSelect.innerHTML = '<option value="">–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å</option>';
                return;
            }

            const filtered = workers.filter(w => w.specialties.includes(specialty));

            if (filtered.length === 0) {
                workerSelect.innerHTML = '<option value="">–ù–µ—Ç —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤ —Å —ç—Ç–æ–π —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å—é</option>';
            } else {
                workerSelect.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞</option>' +
                    filtered.map(w => `<option value="${w.id}">${w.lastName} ${w.firstName} (${w.rate} ‚ÇΩ/—á)</option>`).join('');
            }
        }

        function saveOperation(detailId) {
            const specialty = document.getElementById('opSpecialty').value;
            const workerId = document.getElementById('opWorker').value;
            const hours = parseFloat(document.getElementById('opHours').value);

            if (!specialty || !workerId || !hours || hours <= 0) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!');
                return;
            }

            const workers = getWorkers();
            const worker = workers.find(w => w.id == workerId);
            const detail = currentProject.details.find(d => d.id === detailId);

            detail.operations.push({
                specialty: specialty,
                worker: worker,
                hours: hours
            });

            cancelOperation();
            renderDetails();
        }

        function cancelOperation() {
            const modal = document.getElementById('operationModal');
            if (modal) {
                modal.remove();
            }
        }

        function removeOperation(detailId, index) {
            const detail = currentProject.details.find(d => d.id === detailId);
            detail.operations.splice(index, 1);
            renderDetails();
        }

        function calculateBlankMass(detail) {
            const dims = detail.dimensions;
            const type = detail.blankType;

            if (!detail.material || !detail.material.density) return 0;

            const density = detail.material.density; // –≥/—Å–º¬≥
            let volume = 0; // –≤ —Å–º¬≥

            switch(type) {
                case 'circle':
                    if (dims.diameter && dims.length) {
                        const r = dims.diameter / 20; // –º–º –≤ —Å–º, –¥–µ–ª–∏–º –Ω–∞ 2 –¥–ª—è —Ä–∞–¥–∏—É—Å–∞
                        volume = Math.PI * r * r * (dims.length / 10);
                    }
                    break;
                case 'square':
                    if (dims.side && dims.length) {
                        volume = (dims.side / 10) * (dims.side / 10) * (dims.length / 10);
                    }
                    break;
                case 'tube':
                    if (dims.outerDiameter && dims.innerDiameter && dims.length) {
                        const rOuter = dims.outerDiameter / 20;
                        const rInner = dims.innerDiameter / 20;
                        volume = Math.PI * (rOuter * rOuter - rInner * rInner) * (dims.length / 10);
                    }
                    break;
                case 'hexagon':
                    if (dims.side && dims.length) {
                        const s = dims.side / 10;
                        volume = (3 * Math.sqrt(3) / 2) * s * s * (dims.length / 10);
                    }
                    break;
                case 'corner':
                    if (dims.width && dims.height && dims.thickness && dims.length) {
                        const w = dims.width / 10;
                        const h = dims.height / 10;
                        const t = dims.thickness / 10;
                        const l = dims.length / 10;
                        volume = (w * t + (h - t) * t) * l;
                    }
                    break;
                case 'sheet':
                    if (dims.width && dims.height && dims.thickness) {
                        volume = (dims.width / 10) * (dims.height / 10) * (dims.thickness / 10);
                    }
                    break;
            }

            return volume > 0 ? (volume * density) / 1000 : 0; // –ø–µ—Ä–µ–≤–æ–¥–∏–º –≥ –≤ –∫–≥
        }

        function updateDetailQuantity(id, value) {
            const detail = currentProject.details.find(d => d.id === id);
            detail.quantity = parseInt(value) || 1;
        }

        function updateDetailName(id, value) {
            const detail = currentProject.details.find(d => d.id === id);
            detail.name = value;
        }

        function updateDetailPurpose(id, value) {
            const detail = currentProject.details.find(d => d.id === id);
            detail.purpose = value;
        }

        function updateDetailBlankType(id, value) {
            const detail = currentProject.details.find(d => d.id === id);
            detail.blankType = value;
            detail.dimensions = {};
            renderDetails();
        }

        function updateDetailDimension(id, field, value) {
            const detail = currentProject.details.find(d => d.id === id);
            detail.dimensions[field] = parseFloat(value) || 0;
            renderDetails();
        }

        function updateDetailMaterial(id, materialId) {
            const detail = currentProject.details.find(d => d.id === id);
            const materials = getMaterials();
            detail.material = materials.find(m => m.id == materialId) || null;
            renderDetails();
        }

        function updateDetailComplexity(id, value) {
            const detail = currentProject.details.find(d => d.id === id);
            detail.complexity = parseFloat(value) || 1;
        }

        function removeDetail(id) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å –¥–µ—Ç–∞–ª—å?')) {
                currentProject.details = currentProject.details.filter(d => d.id !== id);
                renderDetails();
            }
        }

        // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
        function addExpense() {
            const expense = {
                id: Date.now(),
                description: '',
                amount: 0
            };

            currentProject.expenses.push(expense);
            renderExpenses();
        }

        function renderExpenses() {
            const container = document.getElementById('expensesList');

            if (currentProject.expenses.length === 0) {
                container.innerHTML = '<p style="color: #999;">–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö —Ä–∞—Å—Ö–æ–¥–æ–≤ –Ω–µ—Ç</p>';
                return;
            }

            container.innerHTML = currentProject.expenses.map((expense, index) => `
                <div class="operation-item">
                    <div style="flex: 1; display: flex; gap: 15px;">
                        <input type="text" value="${expense.description}" 
                            placeholder="–û–ø–∏—Å–∞–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞"
                            style="flex: 2;"
                            onchange="updateExpenseDescription(${expense.id}, this.value)">
                        <input type="number" value="${expense.amount}" 
                            placeholder="–°—É–º–º–∞"
                            style="flex: 1;"
                            onchange="updateExpenseAmount(${expense.id}, this.value)">
                    </div>
                    <button class="btn btn-danger" onclick="removeExpense(${expense.id})">√ó</button>
                </div>
            `).join('');
        }

        function updateExpenseDescription(id, value) {
            const expense = currentProject.expenses.find(e => e.id === id);
            expense.description = value;
        }

        function updateExpenseAmount(id, value) {
            const expense = currentProject.expenses.find(e => e.id === id);
            expense.amount = parseFloat(value) || 0;
        }

        function removeExpense(id) {
            currentProject.expenses = currentProject.expenses.filter(e => e.id !== id);
            renderExpenses();
        }

        // –†–∞—Å—á–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞
        function calculateProject() {
            const name = document.getElementById('projectName').value.trim();
            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞!');
                return;
            }

            if (currentProject.details.length === 0) {
                alert('–î–æ–±–∞–≤—å—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –¥–µ—Ç–∞–ª—å!');
                return;
            }

            currentProject.name = name;
            currentProject.hourRate = parseFloat(document.getElementById('hourRate').value) || 500;
            currentProject.totalTime = parseFloat(document.getElementById('totalTime').value) || 0;
            currentProject.materialCoeff = parseFloat(document.getElementById('materialCoeff').value) || 1.5;
            currentProject.complexityCoeff = parseFloat(document.getElementById('complexityCoeff').value) || 1.2;
            currentProject.date = new Date().toLocaleDateString('ru-RU');

            generateReport();
            showSection('reportSection');
        }

        function generateReport() {
            const report = document.getElementById('reportContent');
            const mode = currentProject.mode;

            let totalMaterialsCost = 0;
            let totalLaborCost = 0;
            let totalExpensesCost = 0;

            // –†–∞—Å—á–µ—Ç –ø–æ –¥–µ—Ç–∞–ª—è–º
            const detailsReport = currentProject.details.map(detail => {
                const mass = calculateBlankMass(detail);
                const materialCostPerUnit = detail.material && mass ? mass * detail.material.price : 0;
                
                let detailLaborCost = 0;
                let detailTimePerUnit = 0;
                
                detail.operations.forEach(op => {
                    detailTimePerUnit += op.hours;
                    detailLaborCost += op.hours * op.worker.rate;
                });

                const totalDetailTime = detailTimePerUnit * detail.quantity;
                const totalDetailLaborCost = detailLaborCost * detail.quantity;

                let totalDetailMaterialCost = 0;
                
                if (mode === 'mass') {
                    totalDetailMaterialCost = materialCostPerUnit * detail.quantity * 
                                             currentProject.materialCoeff * detail.complexity;
                } else {
                    totalDetailMaterialCost = materialCostPerUnit * detail.quantity;
                }

                totalMaterialsCost += totalDetailMaterialCost;
                totalLaborCost += totalDetailLaborCost;

                return {
                    detail,
                    mass,
                    materialCostPerUnit,
                    detailTimePerUnit,
                    totalDetailTime,
                    totalDetailMaterialCost,
                    totalDetailLaborCost
                };
            });

            // –£—á–µ—Ç –æ–±—â–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ (–µ—Å–ª–∏ —É–∫–∞–∑–∞–Ω–æ)
            if (mode === 'time' && currentProject.totalTime > 0) {
                totalLaborCost += currentProject.totalTime * currentProject.hourRate;
            }

            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
            currentProject.expenses.forEach(expense => {
                totalExpensesCost += expense.amount;
            });

            const grandTotal = totalMaterialsCost + totalLaborCost + totalExpensesCost;

            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º
            const workerStats = {};
            detailsReport.forEach((item, idx) => {
                item.detail.operations.forEach(op => {
                    const key = `${op.worker.id}`;
                    if (!workerStats[key]) {
                        workerStats[key] = {
                            worker: op.worker,
                            totalHours: 0,
                            totalCost: 0,
                            tasks: []
                        };
                    }
                    const taskHours = op.hours * item.detail.quantity;
                    const taskCost = taskHours * op.worker.rate;
                    workerStats[key].totalHours += taskHours;
                    workerStats[key].totalCost += taskCost;
                    workerStats[key].tasks.push({
                        detailIndex: idx + 1,
                        specialty: op.specialty,
                        hours: taskHours,
                        cost: taskCost,
                        quantity: item.detail.quantity
                    });
                });
            });

            // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è HTML –æ—Ç—á–µ—Ç–∞
            report.innerHTML = `
                <div class="report-header">
                    <h1>–û–¢–ß–ï–¢ –ü–û –ü–†–û–ï–ö–¢–£</h1>
                    <h2>"${currentProject.name}"</h2>
                    <p>–î–∞—Ç–∞: ${currentProject.date}</p>
                    <p>–†–µ–∂–∏–º —Ä–∞—Å—á–µ—Ç–∞: ${mode === 'time' ? 'üïê –ü–æ –≤—Ä–µ–º–µ–Ω–∏' : '‚öñÔ∏è –ü–æ –º–∞—Å—Å–µ –∑–∞–≥–æ—Ç–æ–≤–∫–∏'}</p>
                </div>

                ${detailsReport.length > 0 ? `
                    <div class="report-section">
                        <h3>üì¶ –ú–ê–¢–ï–†–ò–ê–õ–´ –ù–ê –ó–ê–ö–£–ü–ö–£</h3>
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>–î–µ—Ç–∞–ª—å</th>
                                    <th>–ó–∞–≥–æ—Ç–æ–≤–∫–∞</th>
                                    <th>–ú–∞—Ç–µ—Ä–∏–∞–ª</th>
                                    <th>–ö–æ–ª-–≤–æ</th>
                                    <th>–ú–∞—Å—Å–∞ –µ–¥.</th>
                                    <th>–û–±—â–∞—è –º–∞—Å—Å–∞</th>
                                    <th>–°—Ç–æ–∏–º–æ—Å—Ç—å</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${detailsReport.map((item, idx) => {
                                    const blankDesc = getBlankDescription(item.detail);
                                    const detailName = item.detail.name || `–î–µ—Ç–∞–ª—å #${idx + 1}`;
                                    const detailInfo = item.detail.purpose 
                                        ? `${detailName}<br><small style="color: #666;">${item.detail.purpose}</small>`
                                        : detailName;
                                    return `
                                        <tr>
                                            <td><strong>${detailInfo}</strong></td>
                                            <td>${blankDesc}</td>
                                            <td>${item.detail.material?.name || '‚Äî'}</td>
                                            <td>${item.detail.quantity} —à—Ç</td>
                                            <td>${item.mass.toFixed(2)} –∫–≥</td>
                                            <td>${(item.mass * item.detail.quantity).toFixed(2)} –∫–≥</td>
                                            <td>${item.totalDetailMaterialCost.toFixed(2)} ‚ÇΩ</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    </div>
                ` : ''}

                ${Object.keys(workerStats).length > 0 ? `
                    <div class="report-section">
                        <h3>üë∑ –ü–õ–ê–ù –†–ê–ë–û–¢–´ –î–õ–Ø –°–û–¢–†–£–î–ù–ò–ö–û–í</h3>
                        ${Object.values(workerStats).map(stat => `
                            <div style="background: #f9f9f9; padding: 15px; margin: 15px 0; border-radius: 8px; border-left: 4px solid #d4af37;">
                                <h4 style="color: #1a1a2e; margin-bottom: 10px;">
                                    ${stat.worker.lastName} ${stat.worker.firstName}
                                </h4>
                                <table class="report-table" style="margin-top: 10px;">
                                    <thead>
                                        <tr>
                                            <th>–î–µ—Ç–∞–ª—å</th>
                                            <th>–û–ø–µ—Ä–∞—Ü–∏—è</th>
                                            <th>–í—Ä–µ–º—è</th>
                                            <th>–û–ø–ª–∞—Ç–∞</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        ${stat.tasks.map(task => {
                                            const detail = currentProject.details[task.detailIndex - 1];
                                            const detailName = detail?.name || `–î–µ—Ç–∞–ª—å #${task.detailIndex}`;
                                            return `
                                                <tr>
                                                    <td><strong>${detailName}</strong></td>
                                                    <td>${task.specialty}</td>
                                                    <td>${task.hours.toFixed(1)} —á ${task.quantity > 1 ? `(${(task.hours/task.quantity).toFixed(1)} —á √ó ${task.quantity} —à—Ç)` : ''}</td>
                                                    <td>${task.cost.toFixed(2)} ‚ÇΩ</td>
                                                </tr>
                                            `;
                                        }).join('')}
                                        <tr style="background: #d4af37; font-weight: bold;">
                                            <td colspan="2"><strong>–ò–¢–û–ì–û –¥–ª—è ${stat.worker.lastName}</strong></td>
                                            <td><strong>${stat.totalHours.toFixed(1)} —á</strong></td>
                                            <td><strong>${stat.totalCost.toFixed(2)} ‚ÇΩ</strong></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        `).join('')}
                    </div>
                ` : ''}

                ${detailsReport.some(d => d.detail.operations.length > 0) || currentProject.totalTime > 0 ? `
                    <div class="report-section">
                        <h3>üí∞ –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ü–û –ó–ê–†–ü–õ–ê–¢–ê–ú</h3>
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>–†–∞–±–æ—Ç–Ω–∏–∫</th>
                                    <th>–û–±—â–µ–µ –≤—Ä–µ–º—è</th>
                                    <th>–°—Ç–∞–≤–∫–∞</th>
                                    <th>–ó–∞—Ä–ø–ª–∞—Ç–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${currentProject.totalTime > 0 ? `
                                    <tr>
                                        <td><strong>–û–±—â–µ–µ –≤—Ä–µ–º—è (–±–µ–∑ –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–∏)</strong></td>
                                        <td>${currentProject.totalTime} —á</td>
                                        <td>${currentProject.hourRate} ‚ÇΩ/—á</td>
                                        <td><strong>${(currentProject.totalTime * currentProject.hourRate).toFixed(2)} ‚ÇΩ</strong></td>
                                    </tr>
                                ` : ''}
                                ${Object.values(workerStats).map(stat => `
                                    <tr>
                                        <td>${stat.worker.lastName} ${stat.worker.firstName}</td>
                                        <td>${stat.totalHours.toFixed(1)} —á</td>
                                        <td>${stat.worker.rate} ‚ÇΩ/—á</td>
                                        <td><strong>${stat.totalCost.toFixed(2)} ‚ÇΩ</strong></td>
                                    </tr>
                                `).join('')}
                                <tr style="background: #f4e4a6; font-weight: bold; font-size: 1.1em;">
                                    <td colspan="3"><strong>–í–°–ï–ì–û –ù–ê –ó–ê–†–ü–õ–ê–¢–´:</strong></td>
                                    <td><strong>${totalLaborCost.toFixed(2)} ‚ÇΩ</strong></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                ` : ''}

                ${currentProject.expenses.length > 0 ? `
                    <div class="report-section">
                        <h3>üí∏ –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ê–°–•–û–î–´</h3>
                        <table class="report-table">
                            <thead>
                                <tr>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–°—É–º–º–∞</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${currentProject.expenses.map(expense => `
                                    <tr>
                                        <td>${expense.description || '–ë–µ–∑ –æ–ø–∏—Å–∞–Ω–∏—è'}</td>
                                        <td>${expense.amount.toFixed(2)} ‚ÇΩ</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                ` : ''}

                <div class="report-total">
                    <h3>üí∞ –ò–¢–û–ì–û</h3>
                    <div class="total-row">
                        <span>–ú–∞—Ç–µ—Ä–∏–∞–ª—ã:</span>
                        <span>${totalMaterialsCost.toFixed(2)} ‚ÇΩ</span>
                    </div>
                    <div class="total-row">
                        <span>–ó–∞—Ä–ø–ª–∞—Ç—ã —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤:</span>
                        <span>${totalLaborCost.toFixed(2)} ‚ÇΩ</span>
                    </div>
                    ${totalExpensesCost > 0 ? `
                        <div class="total-row">
                            <span>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã:</span>
                            <span>${totalExpensesCost.toFixed(2)} ‚ÇΩ</span>
                        </div>
                    ` : ''}
                    <div class="total-row grand">
                        <span>–í–°–ï–ì–û:</span>
                        <span>${grandTotal.toFixed(2)} ‚ÇΩ</span>
                    </div>
                </div>
            `;
        }

        function getBlankDescription(detail) {
            const type = BLANK_TYPES[detail.blankType].name;
            const dims = detail.dimensions;
            
            let desc = type;
            if (detail.blankType === 'circle') {
                desc += dims.diameter && dims.length ? ` √ò${dims.diameter}√ó${dims.length}–º–º` : '';
            } else if (detail.blankType === 'square') {
                desc += dims.side && dims.length ? ` ${dims.side}√ó${dims.length}–º–º` : '';
            } else if (detail.blankType === 'tube') {
                desc += dims.outerDiameter && dims.innerDiameter && dims.length 
                    ? ` √ò${dims.outerDiameter}/√ò${dims.innerDiameter}√ó${dims.length}–º–º` : '';
            } else if (detail.blankType === 'hexagon') {
                desc += dims.side && dims.length ? ` S${dims.side}√ó${dims.length}–º–º` : '';
            } else if (detail.blankType === 'corner') {
                desc += dims.width && dims.height && dims.thickness && dims.length 
                    ? ` ${dims.width}√ó${dims.height}√ó${dims.thickness}√ó${dims.length}–º–º` : '';
            } else if (detail.blankType === 'sheet') {
                desc += dims.width && dims.height && dims.thickness 
                    ? ` ${dims.width}√ó${dims.height}√ó${dims.thickness}–º–º` : '';
            }
            
            return desc;
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞
        function saveProject() {
            const projects = getProjects();
            const existingIndex = projects.findIndex(p => p.id === currentProject.id);

            if (existingIndex >= 0) {
                projects[existingIndex] = { ...currentProject, id: currentProject.id };
            } else {
                currentProject.id = Date.now();
                projects.push({ ...currentProject });
            }

            saveProjects(projects);
            alert('‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω!');
        }

        function exportToJSON() {
            const dataStr = JSON.stringify(currentProject, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `project_${currentProject.name.replace(/\s+/g, '_')}.json`;
            link.click();
        }

        // –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤
        function renderProjectsList() {
            const container = document.getElementById('projectsListContent');
            const projects = getProjects();

            if (projects.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i>üìÅ</i>
                        <h3>–ü—Ä–æ–µ–∫—Ç–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                        <p>–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç!</p>
                    </div>
                `;
                return;
            }

            container.innerHTML = projects.map(project => {
                const detailsPreview = project.details.length > 0
                    ? project.details.slice(0, 3).map(d => d.name || '–ë–µ–∑ –Ω–∞–∑–≤–∞–Ω–∏—è').join(', ')
                    : '–î–µ—Ç–∞–ª–∏ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã';
                const moreDetails = project.details.length > 3 ? ` –∏ –µ—â—ë ${project.details.length - 3}...` : '';
                
                return `
                    <div class="list-item">
                        <div class="list-item-info">
                            <h3>${project.name}</h3>
                            <p style="color: #aaa;">
                                ${project.date} | 
                                ${project.mode === 'time' ? 'üïê –ü–æ –≤—Ä–µ–º–µ–Ω–∏' : '‚öñÔ∏è –ü–æ –º–∞—Å—Å–µ'} | 
                                ${project.details.length} –¥–µ—Ç–∞–ª–µ–π
                            </p>
                            <p style="color: #d4af37; font-size: 0.9em; margin-top: 5px;">
                                ${detailsPreview}${moreDetails}
                            </p>
                        </div>
                        <div class="list-item-actions">
                            <button class="btn btn-secondary" onclick="loadProject(${project.id})">–û—Ç–∫—Ä—ã—Ç—å</button>
                            <button class="btn btn-danger" onclick="deleteProject(${project.id})">–£–¥–∞–ª–∏—Ç—å</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function loadProject(id) {
            const projects = getProjects();
            const project = projects.find(p => p.id === id);
            if (!project) return;

            currentProject = { ...project };
            
            document.getElementById('projectName').value = project.name;
            document.querySelector(`input[name="calcMode"][value="${project.mode}"]`).checked = true;
            document.getElementById('hourRate').value = project.hourRate;
            document.getElementById('totalTime').value = project.totalTime;
            document.getElementById('materialCoeff').value = project.materialCoeff;
            document.getElementById('complexityCoeff').value = project.complexityCoeff;

            toggleCalcMode();
            renderDetails();
            renderExpenses();
            showSection('newProject');
        }

        function deleteProject(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç?')) return;
            
            const projects = getProjects();
            saveProjects(projects.filter(p => p.id !== id));
            renderProjectsList();
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–Ω–∏–∫–∞–º–∏
        function renderWorkers() {
            renderSpecialtiesCheckboxes();
            const container = document.getElementById('workersList');
            const workers = getWorkers();

            if (workers.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p></div>';
                return;
            }

            container.innerHTML = workers.map(worker => `
                <div class="list-item">
                    <div class="list-item-info">
                        <h3>${worker.lastName} ${worker.firstName}</h3>
                        <p style="color: #d4af37;">–°—Ç–∞–≤–∫–∞: ${worker.rate} ‚ÇΩ/—á–∞—Å</p>
                        <div>
                            ${worker.specialties.map(s => `<span class="badge">${s}</span>`).join('')}
                        </div>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-danger" onclick="deleteWorker(${worker.id})">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        function renderSpecialtiesCheckboxes() {
            const container = document.getElementById('specialtiesCheckboxes');
            container.innerHTML = SPECIALTIES.map(specialty => `
                <label>
                    <input type="checkbox" value="${specialty}">
                    ${specialty}
                </label>
            `).join('');
        }

        function addWorker() {
            const lastName = document.getElementById('workerLastName').value.trim();
            const firstName = document.getElementById('workerFirstName').value.trim();
            const rate = parseFloat(document.getElementById('workerRate').value);

            if (!lastName || !firstName) {
                alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û!');
                return;
            }

            const checkboxes = document.querySelectorAll('#specialtiesCheckboxes input:checked');
            const specialties = Array.from(checkboxes).map(cb => cb.value);

            if (specialties.length === 0) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å!');
                return;
            }

            const workers = getWorkers();
            workers.push({
                id: Date.now(),
                lastName,
                firstName,
                rate,
                specialties
            });

            saveWorkers(workers);
            
            document.getElementById('workerLastName').value = '';
            document.getElementById('workerFirstName').value = '';
            document.getElementById('workerRate').value = '500';
            document.querySelectorAll('#specialtiesCheckboxes input').forEach(cb => cb.checked = false);

            renderWorkers();
        }

        function deleteWorker(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞?')) return;
            
            const workers = getWorkers();
            saveWorkers(workers.filter(w => w.id !== id));
            renderWorkers();
        }

        function exportWorkers() {
            const workers = getWorkers();
            if (workers.length === 0) {
                alert('–ë–∞–∑–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ –ø—É—Å—Ç–∞!');
                return;
            }

            const dataStr = JSON.stringify(workers, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `workers_database_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('‚úÖ –ë–∞–∑–∞ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞!');
        }

        function importWorkers() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const workers = JSON.parse(event.target.result);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
                        if (!Array.isArray(workers)) {
                            throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                        }

                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã ID –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
                        const existingWorkers = getWorkers();
                        const maxId = existingWorkers.length > 0 
                            ? Math.max(...existingWorkers.map(w => w.id))
                            : 0;
                        
                        workers.forEach((worker, index) => {
                            if (!worker.id || existingWorkers.some(w => w.id === worker.id)) {
                                worker.id = maxId + index + 1;
                            }
                        });

                        const mergeOption = confirm(
                            '–û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞–º–∏?\n\n' +
                            '–î–ê - –¥–æ–±–∞–≤–∏—Ç—å –∫ —Ç–µ–∫—É—â–µ–π –±–∞–∑–µ\n' +
                            '–ù–ï–¢ - –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å—é –±–∞–∑—É'
                        );

                        if (mergeOption) {
                            const merged = [...existingWorkers, ...workers];
                            saveWorkers(merged);
                            alert(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${workers.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤!`);
                        } else {
                            saveWorkers(workers);
                            alert(`‚úÖ –ë–∞–∑–∞ –∑–∞–º–µ–Ω–µ–Ω–∞. –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${workers.length} —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤!`);
                        }

                        renderWorkers();
                    } catch (err) {
                        alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ' + err.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏
        function renderMaterials() {
            const container = document.getElementById('materialsList');
            const materials = getMaterials();

            if (materials.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>–ú–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</p></div>';
                return;
            }

            container.innerHTML = materials.map(material => `
                <div class="list-item">
                    <div class="list-item-info">
                        <h3>${material.name}</h3>
                        <p style="color: #d4af37;">
                            –¶–µ–Ω–∞: ${material.price} ‚ÇΩ/–∫–≥ | 
                            –ü–ª–æ—Ç–Ω–æ—Å—Ç—å: ${material.density || '7.85'} –≥/—Å–º¬≥
                        </p>
                    </div>
                    <div class="list-item-actions">
                        <button class="btn btn-danger" onclick="deleteMaterial(${material.id})">–£–¥–∞–ª–∏—Ç—å</button>
                    </div>
                </div>
            `).join('');
        }

        function addMaterial() {
            const name = document.getElementById('materialName').value.trim();
            const price = parseFloat(document.getElementById('materialPrice').value);
            const density = parseFloat(document.getElementById('materialDensity').value);

            if (!name) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –º–∞—Ç–µ—Ä–∏–∞–ª–∞!');
                return;
            }

            if (isNaN(price) || price <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ü–µ–Ω—É!');
                return;
            }

            if (isNaN(density) || density <= 0) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é –ø–ª–æ—Ç–Ω–æ—Å—Ç—å!');
                return;
            }

            const materials = getMaterials();
            materials.push({
                id: Date.now(),
                name,
                price,
                density
            });

            saveMaterials(materials);
            
            document.getElementById('materialName').value = '';
            document.getElementById('materialPrice').value = '45';
            document.getElementById('materialDensity').value = '7.85';

            renderMaterials();
        }

        function deleteMaterial(id) {
            if (!confirm('–£–¥–∞–ª–∏—Ç—å –º–∞—Ç–µ—Ä–∏–∞–ª?')) return;
            
            const materials = getMaterials();
            saveMaterials(materials.filter(m => m.id !== id));
            renderMaterials();
        }

        function exportMaterials() {
            const materials = getMaterials();
            if (materials.length === 0) {
                alert('–ë–∞–∑–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ –ø—É—Å—Ç–∞!');
                return;
            }

            const dataStr = JSON.stringify(materials, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `materials_database_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            alert('‚úÖ –ë–∞–∑–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–∞!');
        }

        function importMaterials() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = function(event) {
                    try {
                        const materials = JSON.parse(event.target.result);
                        
                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö
                        if (!Array.isArray(materials)) {
                            throw new Error('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
                        }

                        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥—É–±–ª–∏–∫–∞—Ç—ã ID –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
                        const existingMaterials = getMaterials();
                        const maxId = existingMaterials.length > 0 
                            ? Math.max(...existingMaterials.map(m => m.id))
                            : 0;
                        
                        materials.forEach((material, index) => {
                            if (!material.id || existingMaterials.some(m => m.id === material.id)) {
                                material.id = maxId + index + 1;
                            }
                            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–ª–æ—Ç–Ω–æ—Å—Ç—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
                            if (!material.density) {
                                material.density = 7.85;
                            }
                        });

                        const mergeOption = confirm(
                            '–û–±—ä–µ–¥–∏–Ω–∏—Ç—å —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏?\n\n' +
                            '–î–ê - –¥–æ–±–∞–≤–∏—Ç—å –∫ —Ç–µ–∫—É—â–µ–π –±–∞–∑–µ\n' +
                            '–ù–ï–¢ - –∑–∞–º–µ–Ω–∏—Ç—å –≤—Å—é –±–∞–∑—É'
                        );

                        if (mergeOption) {
                            const merged = [...existingMaterials, ...materials];
                            saveMaterials(merged);
                            alert(`‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ ${materials.length} –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤!`);
                        } else {
                            saveMaterials(materials);
                            alert(`‚úÖ –ë–∞–∑–∞ –∑–∞–º–µ–Ω–µ–Ω–∞. –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${materials.length} –º–∞—Ç–µ—Ä–∏–∞–ª–æ–≤!`);
                        }

                        renderMaterials();
                    } catch (err) {
                        alert('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–∞: ' + err.message);
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
        window.onload = function() {
            loadData();
            showSection('mainMenu');
        };
    </script>
</body>
</html>
